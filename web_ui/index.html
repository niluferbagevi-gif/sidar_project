<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Sƒ∞DAR ‚Äî Yazƒ±lƒ±m M√ºhendisi AI</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
--bg:#1c1c1c;--bg2:#252525;--bg3:#2e2e2e;--bg4:#383838;
--border:rgba(255,255,255,.07);--border2:rgba(255,255,255,.13);
--text:#e8e8e8;--text-dim:#8a8a8a;--text-muted:#555;
--accent:#e07b39;--accent2:#c96820;
--green:#3fb950;--red:#f85149;--yellow:#d29922;--blue:#79c0ff;
--radius:8px;--radius-lg:12px;
}
[data-theme="light"]{
--bg:#f6f6f6;--bg2:#ffffff;--bg3:#efefef;--bg4:#e3e3e3;
--border:rgba(0,0,0,.07);--border2:rgba(0,0,0,.13);
--text:#1a1a1a;--text-dim:#666;--text-muted:#999;
--green:#1a7f37;--red:#cf222e;--yellow:#9a6700;
}
html,body{height:100%;background:var(--bg);color:var(--text);
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
font-size:14px;line-height:1.6;}

/* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
.app{display:flex;flex-direction:column;height:100vh;}
.topbar{
display:flex;align-items:center;justify-content:space-between;
padding:0 16px;height:44px;
background:var(--bg2);border-bottom:1px solid var(--border);
flex-shrink:0;
}
.topbar-left{display:flex;align-items:center;gap:10px;}
.logo-sq{
width:26px;height:26px;border-radius:6px;
background:linear-gradient(135deg,#e07b39,#c96820);
display:flex;align-items:center;justify-content:center;
font-size:10px;font-weight:900;color:#fff;letter-spacing:-.5px;flex-shrink:0;
}
.logo-name{font-size:13px;font-weight:700;color:var(--text);}
.logo-badge{
padding:2px 7px;border-radius:10px;font-size:10px;font-weight:500;
background:rgba(224,123,57,.15);color:var(--accent);border:1px solid rgba(224,123,57,.3);
}
.topbar-right{display:flex;align-items:center;gap:6px;}
.tb-btn{
padding:4px 8px;background:transparent;border:1px solid var(--border2);
border-radius:6px;color:var(--text-dim);cursor:pointer;font-size:12px;
font-family:inherit;transition:color .15s,border-color .15s,background .15s;
display:flex;align-items:center;gap:4px;white-space:nowrap;line-height:1.4;
}
.tb-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(224,123,57,.08);}
.tb-btn.danger:hover{border-color:var(--red);color:var(--red);background:rgba(248,81,73,.08);}
.tb-icon{padding:4px 6px;font-size:15px;}

/* ‚îÄ‚îÄ Main wrapper ‚îÄ‚îÄ */
.main-wrapper{display:flex;flex:1;overflow:hidden;}

/* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
.sidebar{
width:320px;flex-shrink:0;display:flex;flex-direction:column;
background:var(--bg2);border-right:1px solid var(--border);overflow:hidden;
}

/* Prompt box */
.prompt-wrap{padding:12px;border-bottom:1px solid var(--border);}
.prompt-box{
background:var(--bg4);border:1px solid var(--border2);border-radius:var(--radius-lg);
overflow:hidden;transition:border-color .15s;
}
.prompt-box:focus-within{border-color:rgba(224,123,57,.6);}
#task-input{
width:100%;background:transparent;border:none;outline:none;
color:var(--text);font-size:13px;font-family:inherit;
padding:12px 14px 8px;resize:none;
min-height:80px;max-height:220px;line-height:1.55;
}
#task-input::placeholder{color:var(--text-muted);}
.prompt-toolbar{
display:flex;align-items:center;justify-content:space-between;
padding:6px 10px 8px;gap:6px;border-top:1px solid var(--border);
}
.prompt-tools{display:flex;align-items:center;gap:4px;}
.pt-btn{
padding:4px 8px;background:transparent;border:1px solid transparent;
border-radius:6px;color:var(--text-dim);cursor:pointer;font-size:11.5px;
font-family:inherit;display:flex;align-items:center;gap:4px;
transition:color .12s,background .12s,border-color .12s;
}
.pt-btn:hover{color:var(--text);background:var(--bg3);border-color:var(--border2);}
.attach-label-sb{cursor:pointer;}
.attach-label-sb:hover{color:var(--text);}
.model-chip{
padding:3px 8px;background:var(--bg3);border:1px solid var(--border2);
border-radius:12px;font-size:11px;color:var(--text-dim);
}
.send-circle{
width:30px;height:30px;border-radius:50%;
background:var(--accent);border:none;cursor:pointer;
display:flex;align-items:center;justify-content:center;
transition:opacity .15s,transform .1s;flex-shrink:0;
}
.send-circle:hover{opacity:.85;}
.send-circle:active{transform:scale(.93);}
.send-circle:disabled{opacity:.35;cursor:not-allowed;}
.send-circle svg{fill:#fff;}

/* Project row */
.project-row{
display:flex;align-items:center;gap:6px;
padding:8px 12px;border-bottom:1px solid var(--border);flex-wrap:wrap;
}
.proj-chip{
display:flex;align-items:center;gap:4px;
padding:4px 9px;background:var(--bg3);border:1px solid var(--border2);
border-radius:12px;cursor:pointer;font-size:11.5px;color:var(--text-dim);
transition:color .12s,border-color .12s;white-space:nowrap;
}
.proj-chip:hover{color:var(--text);border-color:rgba(224,123,57,.5);}
.proj-chip svg{flex-shrink:0;opacity:.7;}

/* Sessions header */
.sessions-hdr{
display:flex;align-items:center;justify-content:space-between;
padding:8px 12px 6px;
}
.sessions-title{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.7px;font-weight:600;}
.sessions-actions{display:flex;gap:4px;}
.icon-btn{
background:transparent;border:none;cursor:pointer;
color:var(--text-muted);padding:3px 5px;border-radius:5px;
transition:color .12s,background .12s;font-size:13px;
}
.icon-btn:hover{color:var(--text);background:var(--bg3);}

/* Session search */
.session-search-wrap{padding:0 10px 6px;}
.session-search{
width:100%;background:var(--bg4);border:1px solid var(--border2);border-radius:7px;
padding:5px 10px;color:var(--text);font-size:12px;font-family:inherit;
outline:none;transition:border-color .15s;
}
.session-search:focus{border-color:rgba(224,123,57,.5);}
.session-search::placeholder{color:var(--text-muted);}

/* Session list */
.session-list{flex:1;overflow-y:auto;padding:4px 8px 8px;}
.session-list::-webkit-scrollbar{width:3px;}
.session-list::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

.session-item{
position:relative;padding:9px 12px;border-radius:8px;cursor:pointer;
margin-bottom:2px;transition:background .12s;border-left:2px solid transparent;
}
.session-item:hover{background:var(--bg3);}
.session-item.active{background:rgba(224,123,57,.08);border-left-color:var(--accent);}
.sess-title{
font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
margin-bottom:3px;font-weight:500;
}
.session-item:not(.active) .sess-title{color:var(--text-dim);}
.sess-meta{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text-muted);flex-wrap:wrap;}
.sess-dot{width:6px;height:6px;border-radius:50%;background:var(--green);flex-shrink:0;}
.sess-del{
position:absolute;right:8px;top:50%;transform:translateY(-50%);
background:none;border:none;color:var(--text-muted);cursor:pointer;
opacity:0;padding:4px;border-radius:4px;transition:color .12s,opacity .12s;
}
.session-item:hover .sess-del{opacity:1;}
.sess-del:hover{color:var(--red);}

/* ‚îÄ‚îÄ Right panel ‚îÄ‚îÄ */
.main-panel{flex:1;display:flex;flex-direction:column;overflow:hidden;}

/* Welcome screen */
#welcome{
display:flex;flex-direction:column;align-items:center;justify-content:center;
flex:1;padding:40px 24px;gap:24px;
}
.welcome-logo{
width:52px;height:52px;border-radius:13px;
background:linear-gradient(135deg,#e07b39,#c96820);
display:flex;align-items:center;justify-content:center;
font-size:18px;font-weight:900;color:#fff;letter-spacing:-.5px;
}
.welcome-title{font-size:20px;font-weight:600;color:var(--text);text-align:center;letter-spacing:-.3px;}
.welcome-sub{font-size:13px;color:var(--text-dim);text-align:center;}
.quick-label{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.7px;margin-bottom:8px;text-align:center;}
.quick-grid{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:560px;}
.quick-chip{
padding:6px 13px;background:var(--bg2);border:1px solid var(--border2);border-radius:16px;
cursor:pointer;font-size:12px;font-family:inherit;color:var(--text-dim);
transition:border-color .15s,color .15s,background .15s;
}
.quick-chip:hover{border-color:var(--accent);color:var(--text);background:rgba(224,123,57,.06);}

/* Chat panel */
#chat-panel{display:none;flex-direction:column;flex:1;overflow:hidden;}
#messages{flex:1;overflow-y:auto;padding:0;scroll-behavior:smooth;}
#messages::-webkit-scrollbar{width:4px;}
#messages::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}

/* Messages */
.message{padding:18px 28px;border-bottom:1px solid var(--border);animation:fadeIn .15s ease;max-width:100%;}
@keyframes fadeIn{from{opacity:0;transform:translateY(3px)}to{opacity:1;transform:translateY(0)}}
.message-user{background:var(--bg3);}
.message-sidar{background:var(--bg);}
.msg-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;font-size:12px;font-weight:600;color:var(--text-dim);}
.msg-avatar{width:22px;height:22px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;flex-shrink:0;}
.avatar-user{background:var(--bg4);color:var(--text-dim);}
.avatar-sidar{background:linear-gradient(135deg,#e07b39,#c96820);color:#fff;}
.msg-body{color:var(--text);word-break:break-word;}
.msg-body p{margin-bottom:10px}.msg-body p:last-child{margin-bottom:0}
.msg-body h1,.msg-body h2,.msg-body h3{margin:14px 0 6px;color:var(--text);}
.msg-body ul,.msg-body ol{padding-left:22px;margin:6px 0}
.msg-body li{margin:3px 0}
.msg-body a{color:var(--accent);text-decoration:none}.msg-body a:hover{text-decoration:underline}
.msg-body blockquote{border-left:3px solid var(--border2);padding-left:12px;color:var(--text-dim);margin:8px 0}
.msg-body :not(pre)>code{background:var(--bg4);padding:2px 6px;border-radius:4px;font-family:"JetBrains Mono","Fira Code",monospace;font-size:12px;color:var(--accent);}
.msg-body pre{background:var(--bg3)!important;border:1px solid var(--border2);border-radius:var(--radius);padding:14px 16px;overflow-x:auto;margin:10px 0;}
.msg-body pre code{background:transparent!important;padding:0;font-family:"JetBrains Mono","Fira Code",monospace;font-size:12px;color:var(--text);}
.msg-body table{border-collapse:collapse;width:100%;margin:10px 0;font-size:13px;}
.msg-body th,.msg-body td{border:1px solid var(--border2);padding:6px 12px;text-align:left;}
.msg-body th{background:var(--bg3);color:var(--text-dim);}
.streaming-text{font-size:14px;white-space:pre-wrap;word-break:break-word;color:var(--text);}
.cursor{display:inline-block;width:2px;height:1em;background:var(--accent);margin-left:1px;vertical-align:text-bottom;animation:blink 1s step-end infinite;}
@keyframes blink{50%{opacity:0}}

/* Code copy btn */
.code-wrap{position:relative;}
.copy-btn{
position:absolute;top:8px;right:8px;padding:3px 8px;
background:var(--bg4);border:1px solid var(--border2);border-radius:5px;
color:var(--text-dim);font-size:11px;cursor:pointer;opacity:0;
transition:opacity .15s,color .15s,border-color .15s;font-family:inherit;
display:flex;align-items:center;gap:4px;
}
.code-wrap:hover .copy-btn{opacity:1;}
.copy-btn:hover{color:var(--accent);border-color:var(--accent);}
.copy-btn.copied{color:var(--green);border-color:var(--green);opacity:1;}

/* Message actions */
.msg-actions{display:flex;gap:4px;margin-top:8px;opacity:0;transition:opacity .15s;}
.message:hover .msg-actions{opacity:1;}
.msg-act-btn{
padding:3px 8px;background:transparent;border:1px solid var(--border2);
border-radius:5px;color:var(--text-muted);font-size:11px;cursor:pointer;
font-family:inherit;transition:color .15s,border-color .15s,background .15s;
}
.msg-act-btn:hover{color:var(--accent);border-color:var(--accent);background:rgba(224,123,57,.07);}

/* Chat footer */
.chat-footer{border-top:1px solid var(--border);background:var(--bg2);padding:10px 20px 12px;flex-shrink:0;}
.chat-input-wrap{max-width:780px;margin:0 auto;}
#attached-file-preview{margin-bottom:4px;}
.attached-file{
display:flex;align-items:center;gap:6px;padding:4px 10px;
background:var(--bg4);border:1px solid var(--border2);border-radius:6px;
font-size:12px;color:var(--text-dim);max-width:320px;
}
.attached-file-remove{cursor:pointer;color:var(--text-muted);margin-left:auto;font-size:14px;line-height:1;background:none;border:none;padding:0 2px;}
.attached-file-remove:hover{color:var(--red);}
.chat-input-box{
display:flex;align-items:flex-end;
background:var(--bg3);border:1px solid var(--border2);
border-radius:var(--radius);gap:6px;padding:7px 9px;
transition:border-color .15s;
}
.chat-input-box:focus-within{border-color:rgba(224,123,57,.55);}
.attach-label{cursor:pointer;color:var(--text-muted);display:flex;align-items:center;padding:3px 5px;border-radius:5px;transition:color .12s,background .12s;flex-shrink:0;}
.attach-label:hover{color:var(--accent);background:rgba(224,123,57,.08);}
#input-area{
flex:1;background:transparent;border:none;color:var(--text);
font-size:13.5px;font-family:inherit;resize:none;min-height:24px;max-height:160px;
overflow-y:auto;outline:none;line-height:1.5;padding:2px 0;
}
#input-area::placeholder{color:var(--text-muted);}
#stop-btn{
padding:5px 12px;background:transparent;border:1px solid var(--red);color:var(--red);
border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;font-family:inherit;
white-space:nowrap;height:30px;flex-shrink:0;display:none;align-items:center;gap:4px;
transition:background .15s;
}
#stop-btn:hover{background:rgba(248,81,73,.1);}
#send-btn{
width:30px;height:30px;border-radius:50%;background:var(--accent);border:none;
cursor:pointer;display:flex;align-items:center;justify-content:center;
transition:opacity .15s;flex-shrink:0;
}
#send-btn:hover{opacity:.85;}
#send-btn:disabled{opacity:.35;cursor:not-allowed;}
#send-btn svg{fill:#fff;}
.chat-hint{margin-top:5px;font-size:11px;color:var(--text-muted);text-align:center;}

/* ‚îÄ‚îÄ Modals ‚îÄ‚îÄ */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.modal-bg.open{display:flex;}
.modal-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--radius-lg);max-width:480px;width:92%;box-shadow:0 16px 64px rgba(0,0,0,.6);overflow:hidden;}
.modal-header{padding:14px 18px 10px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;}
.modal-search{flex:1;background:var(--bg3);border:1px solid var(--border2);border-radius:7px;padding:6px 11px;color:var(--text);font-size:13px;font-family:inherit;outline:none;transition:border-color .15s;}
.modal-search:focus{border-color:rgba(224,123,57,.5);}
.modal-search::placeholder{color:var(--text-muted);}
.modal-close-btn{background:transparent;border:none;color:var(--text-dim);cursor:pointer;font-size:16px;padding:4px 7px;border-radius:5px;transition:color .15s,background .15s;}
.modal-close-btn:hover{color:var(--text);background:var(--bg3);}
.repo-list{max-height:300px;overflow-y:auto;padding:6px;}
.repo-list::-webkit-scrollbar{width:3px;}
.repo-list::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px;}
.repo-item{display:flex;align-items:center;gap:10px;padding:8px 11px;border-radius:7px;cursor:pointer;transition:background .12s;}
.repo-item:hover{background:var(--bg3);}
.repo-item.selected{background:rgba(224,123,57,.12);}
.repo-item-icon{width:30px;height:30px;background:var(--bg4);border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:14px;}
.repo-item-info{flex:1;min-width:0;}
.repo-item-name{font-size:13px;color:var(--text);font-weight:500;}
.repo-item-meta{font-size:11px;color:var(--text-dim);margin-top:1px;}
.repo-item-check{color:var(--accent);font-size:14px;opacity:0;transition:opacity .12s;}
.repo-item.selected .repo-item-check{opacity:1;}

/* Status modal */
.stat-modal-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--radius-lg);padding:20px;max-width:420px;width:92%;box-shadow:0 16px 64px rgba(0,0,0,.6);}
.stat-modal-box h3{font-size:14px;margin-bottom:12px;font-weight:600;}
.stat-grid{display:grid;gap:4px;}
.stat-row{display:flex;justify-content:space-between;align-items:center;padding:6px 11px;background:var(--bg3);border-radius:6px;font-size:12.5px;}
.stat-label{color:var(--text-dim);}.stat-val{color:var(--text);font-weight:500;}
.ok{color:var(--green);}.warn{color:var(--yellow);}
.modal-footer{padding:10px 0 0;border-top:1px solid var(--border);margin-top:8px;}
.btn-modal-action{padding:6px 14px;border:1px solid var(--border2);background:transparent;color:var(--text-dim);border-radius:7px;cursor:pointer;font-size:12px;font-family:inherit;transition:border-color .15s,color .15s;}
.btn-modal-action:hover{border-color:var(--accent);color:var(--accent);}

/* Shortcuts modal */
.shortcuts-modal-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--radius-lg);padding:20px;max-width:400px;width:92%;box-shadow:0 16px 64px rgba(0,0,0,.6);}
.shortcuts-modal-box h3{font-size:14px;margin-bottom:14px;font-weight:600;}
.sc-section{margin-bottom:12px;}
.sc-section-title{font-size:10px;text-transform:uppercase;letter-spacing:.7px;color:var(--text-muted);margin-bottom:5px;}
.sc-row{display:flex;justify-content:space-between;align-items:center;padding:5px 10px;background:var(--bg3);border-radius:6px;margin-bottom:3px;font-size:12px;}
.sc-keys{display:flex;gap:3px;}
.kbd{background:var(--bg4);border:1px solid var(--border2);border-radius:4px;padding:2px 6px;font-size:10.5px;font-family:"JetBrains Mono",monospace;color:var(--accent);}
.sc-desc{color:var(--text-dim);}

/* Responsive */
@media(max-width:768px){.sidebar{display:none;}}
@media(max-width:560px){.welcome-title{font-size:17px;}#welcome{padding:28px 16px;}.message{padding:12px 16px;}}
</style>
</head>
<body>
<div class="app">

<!-- ‚îÄ‚îÄ Top bar ‚îÄ‚îÄ -->
<div class="topbar">
  <div class="topbar-left">
    <div class="logo-sq">SI</div>
    <span class="logo-name">Sƒ∞DAR</span>
    <span class="logo-badge">Research preview</span>
  </div>
  <div class="topbar-right">
    <button class="tb-btn tb-icon" id="theme-btn" onclick="toggleTheme()" title="Tema deƒüi≈ütir">üåô</button>
    <button class="tb-btn tb-icon" onclick="openShortcuts()" title="Klavye kƒ±sayollarƒ±">‚å®</button>
    <button class="tb-btn" onclick="openStatus()">
      <svg width="11" height="11" viewBox="0 0 12 12" fill="currentColor"><circle cx="6" cy="6" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M6 4v2.5L7.5 8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" fill="none"/></svg>
      Durum
    </button>
    <button class="tb-btn danger" onclick="clearMemory()">
      <svg width="11" height="11" viewBox="0 0 12 12" fill="currentColor"><path d="M4.5 1.5h3a.5.5 0 0 1 .5.5v.5h2a.5.5 0 0 1 0 1H2a.5.5 0 0 1 0-1h2V2a.5.5 0 0 1 .5-.5zM3 5l.5 5h5l.5-5H3z"/></svg>
      Temizle
    </button>
  </div>
</div>

<div class="main-wrapper">

<!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
<div class="sidebar">
  <!-- Prompt box -->
  <div class="prompt-wrap">
    <div class="prompt-box">
      <textarea id="task-input" placeholder="Sidar'a bir g√∂rev ver..." rows="4"></textarea>
      <div class="prompt-toolbar">
        <div class="prompt-tools">
          <label class="pt-btn attach-label-sb" title="Dosya ekle">
            <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/></svg>
            Dosya
            <input type="file" id="file-input-sb" style="display:none" accept=".txt,.md,.py,.js,.ts,.json,.yaml,.yml,.toml,.csv,.html,.css,.sh,.go,.rs,.java,.c,.cpp" onchange="handleFileAttach(event)"/>
          </label>
          <span class="model-chip">Sonnet 4.6</span>
        </div>
        <button class="send-circle" id="sidebar-send-btn" onclick="startTask()" title="G√∂revi ba≈ülat">
          <svg width="14" height="14" viewBox="0 0 16 16"><path d="M8 2L8 14M8 2L4 6M8 2L12 6" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Project/Branch row -->
  <div class="project-row">
    <div class="proj-chip" onclick="openRepoModal()" title="Depo se√ß">
      <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/></svg>
      <span id="repo-label">sidar_project</span>
      <span style="opacity:.5;font-size:9px">‚ñæ</span>
    </div>
    <div class="proj-chip" onclick="openBranchModal()" title="Dal se√ß">
      <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg>
      <span id="branch-label">main</span>
      <span style="opacity:.5;font-size:9px">‚ñæ</span>
    </div>
  </div>

  <!-- Sessions header -->
  <div class="sessions-hdr">
    <span class="sessions-title">Sessions</span>
    <div class="sessions-actions">
      <button class="icon-btn" onclick="toggleSessionSearch()" title="Oturumlarda ara">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"/></svg>
      </button>
      <button class="icon-btn" onclick="createNewSession()" title="Yeni sohbet">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"/></svg>
      </button>
    </div>
  </div>

  <div class="session-search-wrap" id="session-search-wrap" style="display:none">
    <input class="session-search" id="session-search" type="text" placeholder="Sohbetlerde ara‚Ä¶" oninput="filterSessions(this.value)"/>
  </div>

  <div class="session-list" id="session-list"></div>
</div>

<!-- ‚îÄ‚îÄ Right panel ‚îÄ‚îÄ -->
<div class="main-panel">

  <!-- Welcome screen -->
  <div id="welcome">
    <div class="welcome-logo">SI</div>
    <div>
      <div class="welcome-title">Sidar'a bir g√∂rev ver</div>
      <div class="welcome-sub">Yazƒ±lƒ±m Mimarƒ± &amp; Ba≈ü M√ºhendis AI</div>
    </div>
    <div class="quick-section">
      <div class="quick-label">Hƒ±zlƒ± g√∂revler</div>
      <div class="quick-grid">
        <button class="quick-chip" onclick="quickTask('Proje dizinini listele ve yapƒ±yƒ± a√ßƒ±kla')">Dizini listele</button>
        <button class="quick-chip" onclick="quickTask('Sistem saƒülƒ±k raporu ver')">Sistem saƒülƒ±ƒüƒ±</button>
        <button class="quick-chip" onclick="quickTask('Projeyi denetle ve hatalarƒ± raporla')">Proje denetimi</button>
        <button class="quick-chip" onclick="quickTask('Son 10 commit\'i listele')">Son commitler</button>
        <button class="quick-chip" onclick="quickTask('web\'de ara: Python async best practices 2026')">Web aramasƒ±</button>
        <button class="quick-chip" onclick="quickTask('pypi: fastapi')">PyPI bilgisi</button>
        <button class="quick-chip" onclick="quickTask('Eri≈üim seviyesi ve g√ºvenlik durumunu g√∂ster')">G√ºvenlik durumu</button>
        <button class="quick-chip" onclick="quickTask('Belge deposunu listele')">RAG belgeler</button>
      </div>
    </div>
  </div>

  <!-- Chat panel -->
  <div id="chat-panel">
    <div id="messages"></div>
    <div class="chat-footer">
      <div class="chat-input-wrap">
        <div id="attached-file-preview"></div>
        <div class="chat-input-box">
          <label class="attach-label" title="Dosya ekle">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/></svg>
            <input type="file" id="file-input" style="display:none" accept=".txt,.md,.py,.js,.ts,.json,.yaml,.yml,.toml,.csv,.html,.css,.sh,.go,.rs,.java,.c,.cpp" onchange="handleFileAttach(event)"/>
          </label>
          <textarea id="input-area" placeholder="Mesaj yaz‚Ä¶" rows="1"></textarea>
          <button id="stop-btn" onclick="stopStreaming()">
            <svg width="9" height="9" viewBox="0 0 9 9" fill="currentColor"><rect width="9" height="9" rx="2"/></svg>
            Durdur
          </button>
          <button id="send-btn" onclick="sendMessage()">
            <svg width="14" height="14" viewBox="0 0 16 16"><path d="M8 2L8 14M8 2L4 6M8 2L12 6" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>
          </button>
        </div>
        <div class="chat-hint">Enter ‚Üí g√∂nder &nbsp;¬∑&nbsp; Shift+Enter ‚Üí yeni satƒ±r</div>
      </div>
    </div>
  </div>

</div><!-- /main-panel -->
</div><!-- /main-wrapper -->
</div><!-- /app -->

<!-- ‚îÄ‚îÄ Repo modal ‚îÄ‚îÄ -->
<div class="modal-bg" id="repo-modal" onclick="modalBgClose(event,'repo-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/></svg>
      <input class="modal-search" id="repo-search" type="text" placeholder="Depo ara‚Ä¶" oninput="filterRepos(this.value)"/>
      <button class="modal-close-btn" onclick="closeModal('repo-modal')">‚úï</button>
    </div>
    <div class="repo-list" id="repo-list"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Branch modal ‚îÄ‚îÄ -->
<div class="modal-bg" id="branch-modal" onclick="modalBgClose(event,'branch-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg>
      <input class="modal-search" id="branch-search" type="text" placeholder="Dal ara‚Ä¶" oninput="filterBranches(this.value)"/>
      <button class="modal-close-btn" onclick="closeModal('branch-modal')">‚úï</button>
    </div>
    <div class="repo-list" id="branch-list"></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Status modal ‚îÄ‚îÄ -->
<div class="modal-bg" id="status-modal" onclick="modalBgClose(event,'status-modal')">
  <div class="stat-modal-box" onclick="event.stopPropagation()">
    <h3>Sistem Durumu</h3>
    <div class="stat-grid" id="stat-grid"><div class="stat-row"><span class="stat-label">Y√ºkleniyor‚Ä¶</span></div></div>
    <div class="modal-footer"><button class="btn-modal-action" onclick="closeModal('status-modal')">Kapat</button></div>
  </div>
</div>

<!-- ‚îÄ‚îÄ Shortcuts modal ‚îÄ‚îÄ -->
<div class="modal-bg" id="shortcuts-modal" onclick="modalBgClose(event,'shortcuts-modal')">
  <div class="shortcuts-modal-box" onclick="event.stopPropagation()">
    <h3>‚å® Klavye Kƒ±sayollarƒ±</h3>
    <div class="sc-section">
      <div class="sc-section-title">Mesajla≈üma</div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Enter</span></div><span class="sc-desc">Mesaj g√∂nder</span></div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Shift</span><span class="kbd">Enter</span></div><span class="sc-desc">Yeni satƒ±r</span></div>
    </div>
    <div class="sc-section">
      <div class="sc-section-title">Aray√ºz</div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Esc</span></div><span class="sc-desc">Modalƒ± kapat / Yanƒ±tƒ± durdur</span></div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Ctrl</span><span class="kbd">K</span></div><span class="sc-desc">Yeni sohbet</span></div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Ctrl</span><span class="kbd">L</span></div><span class="sc-desc">Belleƒüi temizle</span></div>
      <div class="sc-row"><div class="sc-keys"><span class="kbd">Ctrl</span><span class="kbd">T</span></div><span class="sc-desc">Tema deƒüi≈ütir</span></div>
    </div>
    <div class="modal-footer"><button class="btn-modal-action" onclick="closeModal('shortcuts-modal')">Kapat</button></div>
  </div>
</div>

<script>
marked.setOptions({breaks:true,gfm:true});

/* ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ */
let isStreaming=false, msgCounter=0, activeController=null;
let currentRepo='niluferbagevi-gif/sidar_project', currentBranch='main';
let currentSessionId=null, allSessions=[];
let attachedFileContent=null, attachedFileName=null;

const REPOS=[
  {name:'niluferbagevi-gif/sidar_project',desc:'Yazƒ±lƒ±m M√ºhendisi AI',emoji:'ü§ñ'},
  {name:'niluferbagevi-gif/LotusAI',desc:'Lotus AI projesi',emoji:'üå∏'},
];
const BRANCHES=['main','develop','feature/ai-core','hotfix/web-ui'];

/* ‚îÄ‚îÄ‚îÄ Theme ‚îÄ‚îÄ */
function toggleTheme(){
  const html=document.documentElement;
  const next=html.getAttribute('data-theme')==='dark'?'light':'dark';
  html.setAttribute('data-theme',next);
  localStorage.setItem('sidar-theme',next);
  document.getElementById('theme-btn').textContent=next==='dark'?'üåô':'‚òÄ';
}
function applyStoredTheme(){
  const saved=localStorage.getItem('sidar-theme')||'dark';
  document.documentElement.setAttribute('data-theme',saved);
  const btn=document.getElementById('theme-btn');
  if(btn) btn.textContent=saved==='dark'?'üåô':'‚òÄ';
}

/* ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
window.addEventListener('DOMContentLoaded',async()=>{
  applyStoredTheme();
  await loadSessions();
  if(currentSessionId) await loadSessionHistory(currentSessionId,false);
});

/* ‚îÄ‚îÄ‚îÄ Sessions ‚îÄ‚îÄ */
async function loadSessions(){
  try{
    const res=await fetch('/sessions');
    const data=await res.json();
    currentSessionId=data.active_session;
    allSessions=data.sessions||[];
    renderSessionList(allSessions);
  }catch(e){console.error('Sessions error:',e);}
}

function renderSessionList(sessions){
  const el=document.getElementById('session-list');
  el.innerHTML='';
  if(!sessions||!sessions.length) return;
  sessions.forEach(s=>{
    const active=s.id===currentSessionId;
    const div=document.createElement('div');
    div.className='session-item'+(active?' active':'');
    div.onclick=()=>selectSession(s.id);
    const repoShort=currentRepo.split('/')[1]||currentRepo;
    div.innerHTML=`
      <div class="sess-title" title="${escHtml(s.title)}">${escHtml(s.title)}</div>
      <div class="sess-meta">
        <svg width="10" height="10" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"/></svg>
        ${escHtml(repoShort)}
        <span class="sess-dot"></span>
      </div>
      <button class="sess-del" onclick="deleteSession('${s.id}',event)" title="Sil">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 1a.5.5 0 0 0-.5.5v1h6v-1a.5.5 0 0 0-.5-.5h-5ZM2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-1v9a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-9h-1a.5.5 0 0 1-.5-.5Zm3 1v9a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-9H5Z"/></svg>
      </button>`;
    el.appendChild(div);
  });
}

function filterSessions(q){
  if(!q.trim()){renderSessionList(allSessions);return;}
  const l=q.toLowerCase();
  renderSessionList(allSessions.filter(s=>s.title.toLowerCase().includes(l)));
}

function toggleSessionSearch(){
  const wrap=document.getElementById('session-search-wrap');
  const input=document.getElementById('session-search');
  const hidden=wrap.style.display==='none';
  wrap.style.display=hidden?'block':'none';
  if(hidden){input.focus();}else{input.value='';renderSessionList(allSessions);}
}

async function selectSession(id){
  if(id===currentSessionId){showChatPanel();return;}
  currentSessionId=id;
  await loadSessionHistory(id,true);
}

async function loadSessionHistory(id,switchToChat=false){
  try{
    const res=await fetch('/sessions/'+id);
    const data=await res.json();
    if(data.success){
      document.getElementById('messages').innerHTML='';
      msgCounter=0;
      if(data.history&&data.history.length>0){
        data.history.forEach(msg=>{
          if(msg.role==='user') appendUser(msg.content);
          else if(msg.role==='assistant'){const mid=createSidarMsg();finalizeMsg(mid,msg.content);}
        });
        loadSessions();
        if(switchToChat) showChatPanel();
      } else {
        loadSessions();
        if(switchToChat) showWelcome();
      }
    }
  }catch(e){console.error('History error:',e);}
}

async function createNewSession(){
  try{
    const res=await fetch('/sessions/new',{method:'POST'});
    const data=await res.json();
    if(data.success){
      currentSessionId=data.session_id;
      document.getElementById('messages').innerHTML='';
      document.getElementById('task-input').value='';
      document.getElementById('input-area').value='';
      msgCounter=0;
      await loadSessions();
      showWelcome();
    }
  }catch(e){console.error('New session error:',e);}
}

async function deleteSession(id,event){
  event.stopPropagation();
  if(!confirm('Bu sohbet silinecek. Emin misiniz?')) return;
  try{
    const res=await fetch('/sessions/'+id,{method:'DELETE'});
    const data=await res.json();
    if(data.success){
      if(currentSessionId===id){document.getElementById('messages').innerHTML='';showWelcome();}
      await loadSessions();
      if(data.active_session&&currentSessionId===id){
        currentSessionId=data.active_session;
        loadSessionHistory(currentSessionId,false);
      }
    }
  }catch(e){console.error('Delete error:',e);}
}

/* ‚îÄ‚îÄ‚îÄ Panel switching ‚îÄ‚îÄ */
function showWelcome(){
  document.getElementById('welcome').style.display='flex';
  document.getElementById('chat-panel').style.display='none';
}
function showChatPanel(){
  document.getElementById('welcome').style.display='none';
  document.getElementById('chat-panel').style.display='flex';
  document.getElementById('input-area').focus();
}
/* legacy alias */
function showTaskPanel(){showWelcome();}

/* ‚îÄ‚îÄ‚îÄ Send ‚îÄ‚îÄ */
function startTask(){
  const text=document.getElementById('task-input').value.trim();
  if(!text) return;
  document.getElementById('task-input').value='';
  showChatPanel();
  sendText(text);
}
function quickTask(text){document.getElementById('task-input').value=text;startTask();}

function sendMessage(){
  const ta=document.getElementById('input-area');
  const text=ta.value.trim();
  if(!text&&!attachedFileContent) return;
  const finalText=attachedFileContent
    ? text+'\n\n**Dosya: '+attachedFileName+'**\n```\n'+attachedFileContent+'\n```'
    : text;
  ta.value='';ta.style.height='auto';
  removeAttachedFile();
  sendText(finalText);
}

async function sendText(text){
  if(isStreaming) return;
  isStreaming=true;
  const sendBtn=document.getElementById('send-btn');
  const stopBtn=document.getElementById('stop-btn');
  const sbSend=document.getElementById('sidebar-send-btn');
  if(sendBtn){sendBtn.disabled=true;sendBtn.style.display='none';}
  if(stopBtn) stopBtn.style.display='flex';
  if(sbSend) sbSend.disabled=true;

  appendUser(text);
  const msgId=createSidarMsg();
  let accumulated='';
  activeController=new AbortController();
  let timeoutId=null;
  const resetTimeout=()=>{
    if(timeoutId) clearTimeout(timeoutId);
    timeoutId=setTimeout(()=>activeController.abort(),60000);
  };

  try{
    resetTimeout();
    const response=await fetch('/chat',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:text}),signal:activeController.signal
    });
    if(!response.ok){finalizeMsg(msgId,'[HTTP Hatasƒ±] Sunucu '+response.status+' kodu d√∂nd√ºrd√º.');return;}
    const reader=response.body.getReader();
    const decoder=new TextDecoder();
    let buffer='';
    while(true){
      const{done,value}=await reader.read();
      if(done) break;
      resetTimeout();
      buffer+=decoder.decode(value,{stream:true});
      const lines=buffer.split('\n');
      buffer=lines.pop();
      for(const line of lines){
        if(!line.startsWith('data: ')) continue;
        try{
          const parsed=JSON.parse(line.slice(6).trim());
          if(parsed.done) break;
          if(parsed.chunk){accumulated+=parsed.chunk;updateStreaming(msgId,accumulated);}
        }catch{}
      }
    }
  }catch(err){
    if(err.name==='AbortError') accumulated+=(accumulated?'\n\n':''+'*[Yanƒ±t durduruldu.]*');
    else accumulated+='\n\n[Baƒülantƒ± Hatasƒ±: '+err.message+']';
  }finally{
    if(timeoutId) clearTimeout(timeoutId);
    activeController=null;
    finalizeMsg(msgId,accumulated);
    isStreaming=false;
    if(sendBtn){sendBtn.disabled=false;sendBtn.style.display='';}
    if(stopBtn) stopBtn.style.display='none';
    if(sbSend) sbSend.disabled=false;
    loadSessions();
  }
}

function stopStreaming(){if(activeController) activeController.abort();}

/* ‚îÄ‚îÄ‚îÄ File attach ‚îÄ‚îÄ */
function handleFileAttach(e){
  const file=e.target.files[0];
  if(!file) return;
  if(file.size>200*1024){alert('Dosya boyutu 200 KB\'ƒ± a≈üamaz.');e.target.value='';return;}
  const reader=new FileReader();
  reader.onload=ev=>{attachedFileContent=ev.target.result;attachedFileName=file.name;renderAttachedFile(file.name);};
  reader.readAsText(file,'utf-8');
  e.target.value='';
}
function renderAttachedFile(name){
  document.getElementById('attached-file-preview').innerHTML=
    '<div class="attached-file"><svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/></svg><span>'+escHtml(name)+'</span><button class="attached-file-remove" onclick="removeAttachedFile()">‚úï</button></div>';
}
function removeAttachedFile(){attachedFileContent=null;attachedFileName=null;document.getElementById('attached-file-preview').innerHTML='';}

/* ‚îÄ‚îÄ‚îÄ Message helpers ‚îÄ‚îÄ */
function escHtml(str){const d=document.createElement('div');d.appendChild(document.createTextNode(str));return d.innerHTML;}
function scrollBottom(){const m=document.getElementById('messages');m.scrollTop=m.scrollHeight;}

function appendUser(text){
  const msgs=document.getElementById('messages');
  const el=document.createElement('div');
  el.className='message message-user';
  el.innerHTML=`<div class="msg-header"><div class="msg-avatar avatar-user">S</div><span>Sen</span></div>
    <div class="msg-body" style="white-space:pre-wrap">${escHtml(text)}</div>
    <div class="msg-actions">
      <button class="msg-act-btn" onclick="editMessage(${JSON.stringify(text)})">‚úè D√ºzenle</button>
      <button class="msg-act-btn" onclick="copyText(${JSON.stringify(text)},this)">üìã Kopyala</button>
    </div>`;
  msgs.appendChild(el);scrollBottom();
}
function editMessage(originalText){
  const ia=document.getElementById('input-area');
  ia.value=originalText;ia.style.height='auto';
  ia.style.height=Math.min(ia.scrollHeight,160)+'px';ia.focus();
}
function copyText(text,btn){
  navigator.clipboard.writeText(text).then(()=>{
    const o=btn.textContent;btn.textContent='‚úì Kopyalandƒ±';
    setTimeout(()=>btn.textContent=o,1500);
  });
}

function createSidarMsg(){
  const msgs=document.getElementById('messages');
  const id='m'+(++msgCounter);
  const el=document.createElement('div');
  el.className='message message-sidar';el.id=id;
  el.innerHTML=`<div class="msg-header"><div class="msg-avatar avatar-sidar">SI</div><span>Sidar</span></div>
    <div class="msg-body"><span class="streaming-text" id="${id}-txt"></span><span class="cursor" id="${id}-cur"></span></div>`;
  msgs.appendChild(el);scrollBottom();return id;
}
function updateStreaming(id,rawText){
  const span=document.getElementById(id+'-txt');
  if(span) span.textContent=rawText;scrollBottom();
}
function finalizeMsg(id,rawText){
  const el=document.getElementById(id);if(!el) return;
  const body=el.querySelector('.msg-body');
  const cursor=document.getElementById(id+'-cur');
  if(cursor) cursor.remove();
  body.innerHTML=marked.parse(rawText||'*(yanƒ±t alƒ±namadƒ±)*');
  body.querySelectorAll('pre code').forEach(b=>hljs.highlightElement(b));
  body.querySelectorAll('pre').forEach(pre=>{
    const wrap=document.createElement('div');wrap.className='code-wrap';
    pre.parentNode.insertBefore(wrap,pre);wrap.appendChild(pre);
    const btn=document.createElement('button');btn.className='copy-btn';
    btn.innerHTML='<svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg> Kopyala';
    btn.onclick=()=>{
      const code=pre.querySelector('code');
      navigator.clipboard.writeText(code?code.innerText:pre.innerText).then(()=>{
        btn.textContent='‚úì Kopyalandƒ±';btn.classList.add('copied');
        setTimeout(()=>{btn.innerHTML='<svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg> Kopyala';btn.classList.remove('copied');},2000);
      });
    };
    wrap.appendChild(btn);
  });
  scrollBottom();
}

/* ‚îÄ‚îÄ‚îÄ Repo / Branch modals ‚îÄ‚îÄ */
function openRepoModal(){renderRepos(REPOS);document.getElementById('repo-search').value='';document.getElementById('repo-modal').classList.add('open');setTimeout(()=>document.getElementById('repo-search').focus(),50);}
function renderRepos(list){document.getElementById('repo-list').innerHTML=list.map(r=>`<div class="repo-item ${r.name===currentRepo?'selected':''}" onclick="selectRepo('${r.name}')"><div class="repo-item-icon">${r.emoji}</div><div class="repo-item-info"><div class="repo-item-name">${r.name}</div><div class="repo-item-meta">${r.desc}</div></div><span class="repo-item-check">‚úì</span></div>`).join('');}
function filterRepos(q){renderRepos(REPOS.filter(r=>r.name.toLowerCase().includes(q.toLowerCase())));}
function selectRepo(name){currentRepo=name;document.getElementById('repo-label').textContent=name.split('/')[1]||name;closeModal('repo-modal');}

function openBranchModal(){renderBranches(BRANCHES);document.getElementById('branch-search').value='';document.getElementById('branch-modal').classList.add('open');setTimeout(()=>document.getElementById('branch-search').focus(),50);}
function renderBranches(list){document.getElementById('branch-list').innerHTML=list.map(b=>`<div class="repo-item ${b===currentBranch?'selected':''}" onclick="selectBranch('${b}')"><div class="repo-item-icon" style="font-size:16px"><svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg></div><div class="repo-item-info"><div class="repo-item-name">${b}</div></div><span class="repo-item-check">‚úì</span></div>`).join('');}
function filterBranches(q){renderBranches(BRANCHES.filter(b=>b.toLowerCase().includes(q.toLowerCase())));}
function selectBranch(name){currentBranch=name;document.getElementById('branch-label').textContent=name;closeModal('branch-modal');}

/* ‚îÄ‚îÄ‚îÄ Status modal ‚îÄ‚îÄ */
async function openStatus(){
  document.getElementById('status-modal').classList.add('open');
  const grid=document.getElementById('stat-grid');
  grid.innerHTML='<div class="stat-row"><span class="stat-label">Y√ºkleniyor‚Ä¶</span></div>';
  try{
    const data=await(await fetch('/status')).json();
    const row=(l,v,c='')=>`<div class="stat-row"><span class="stat-label">${l}</span><span class="stat-val ${c}">${v}</span></div>`;
    grid.innerHTML=[
      row('S√ºr√ºm','v'+data.version),
      row('AI Saƒülayƒ±cƒ±',data.provider+' / '+data.model),
      row('Eri≈üim',data.access_level.toUpperCase()),
      row('Bellek',data.memory_count+' mesaj'),
      row('GitHub',data.github?'‚úì Baƒülƒ±':'‚úó Yok',data.github?'ok':'warn'),
      row('Web Arama',data.web_search?'‚úì Aktif':'‚úó Yok',data.web_search?'ok':'warn'),
      row('RAG',data.rag_status),
      row('Paket Bilgi','‚úì PyPI + npm','ok'),
    ].join('');
  }catch(e){document.getElementById('stat-grid').innerHTML='<div class="stat-row"><span class="stat-label">Hata: '+escHtml(e.message)+'</span></div>';}
}

/* ‚îÄ‚îÄ‚îÄ Misc ‚îÄ‚îÄ */
function closeModal(id){document.getElementById(id).classList.remove('open');}
function modalBgClose(e,id){if(e.target===document.getElementById(id)) closeModal(id);}
function openShortcuts(){document.getElementById('shortcuts-modal').classList.add('open');}

async function clearMemory(){
  if(!confirm('Ge√ßerli konu≈üma belleƒüi temizlenecek. Devam?')) return;
  try{await fetch('/clear',{method:'POST'});}catch{}
  document.getElementById('messages').innerHTML='';
  showWelcome();loadSessions();
}

/* ‚îÄ‚îÄ‚îÄ Auto-resize textareas ‚îÄ‚îÄ */
['task-input','input-area'].forEach(id=>{
  const el=document.getElementById(id);if(!el) return;
  el.addEventListener('input',()=>{el.style.height='auto';el.style.height=Math.min(el.scrollHeight,id==='task-input'?220:160)+'px';});
  el.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();id==='task-input'?startTask():sendMessage();}});
});

/* ‚îÄ‚îÄ‚îÄ Global shortcuts ‚îÄ‚îÄ */
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    ['repo-modal','branch-modal','status-modal','shortcuts-modal'].forEach(id=>closeModal(id));
    if(isStreaming) stopStreaming();
    return;
  }
  const tag=document.activeElement.tagName;
  if(tag==='INPUT'||tag==='TEXTAREA') return;
  if(e.ctrlKey&&e.key==='k'){e.preventDefault();createNewSession();}
  if(e.ctrlKey&&e.key==='l'){e.preventDefault();clearMemory();}
  if(e.ctrlKey&&e.key==='t'){e.preventDefault();toggleTheme();}
});
</script>
</body>
</html>
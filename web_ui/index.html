<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SÄ°DAR â€” YazÄ±lÄ±m MÃ¼hendisi AI</title>

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #0a0a0f;
      --bg2:       #111118;
      --bg3:       #1a1a24;
      --bg4:       #22222e;
      --border:    #2a2a38;
      --border2:   #3a3a4e;
      --text:      #e2e4f0;
      --text-dim:  #6b6d82;
      --text-muted:#4a4c60;
      --accent:    #a78bfa;
      --accent2:   #7c3aed;
      --green:     #34d399;
      --red:       #f87171;
      --yellow:    #fbbf24;
      --user-bg:   #1a1a2e;
      --sidar-bg:  #111118;
      --radius:    10px;
      --radius-lg: 16px;
    }

    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      font-size: 14px;
      line-height: 1.6;
    }

    /* â”€â”€ Ana dÃ¼zen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* â”€â”€ Ãœst bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      border-bottom: 1px solid var(--border);
      background: var(--bg2);
      flex-shrink: 0;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      border-radius: 7px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 11px;
      color: #fff;
      letter-spacing: -0.5px;
      flex-shrink: 0;
    }

    .logo-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }

    .topbar-divider {
      width: 1px;
      height: 18px;
      background: var(--border2);
    }

    .nav-tabs {
      display: flex;
      gap: 2px;
    }

    .nav-tab {
      padding: 5px 12px;
      border-radius: 6px;
      font-size: 13px;
      color: var(--text-dim);
      cursor: pointer;
      transition: color .15s, background .15s;
      border: none;
      background: transparent;
      font-family: inherit;
    }
    .nav-tab:hover  { color: var(--text); background: var(--bg3); }
    .nav-tab.active { color: var(--text); background: var(--bg3); }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-ghost {
      padding: 5px 12px;
      border: 1px solid var(--border2);
      background: transparent;
      color: var(--text-dim);
      border-radius: 7px;
      cursor: pointer;
      font-size: 12px;
      font-family: inherit;
      transition: border-color .15s, color .15s, background .15s;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .btn-ghost:hover { border-color: var(--accent); color: var(--accent); background: rgba(124,58,237,.08); }
    .btn-ghost.danger:hover { border-color: var(--red); color: var(--red); background: rgba(248,113,113,.08); }

    /* â”€â”€ Ä°Ã§erik alanÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .content {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ KarÅŸÄ±lama / GÃ¶rev tanÄ±mlama â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #task-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      padding: 40px 20px;
      gap: 28px;
    }

    .task-header {
      text-align: center;
    }

    .task-title {
      font-size: 22px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
      letter-spacing: -0.3px;
    }

    .task-sub {
      font-size: 13px;
      color: var(--text-dim);
    }

    /* â”€â”€ GÃ¶rev kutusu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .task-box {
      width: 100%;
      max-width: 680px;
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 4px 32px rgba(0,0,0,.4);
      transition: border-color .2s;
    }
    .task-box:focus-within { border-color: var(--accent); box-shadow: 0 4px 32px rgba(124,58,237,.15); }

    #task-input {
      width: 100%;
      background: transparent;
      border: none;
      padding: 18px 20px 12px;
      color: var(--text);
      font-size: 15px;
      font-family: inherit;
      resize: none;
      min-height: 100px;
      max-height: 260px;
      outline: none;
      line-height: 1.6;
    }
    #task-input::placeholder { color: var(--text-muted); }

    .task-box-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px 14px;
      gap: 10px;
      border-top: 1px solid var(--border);
    }

    .task-selectors {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .selector-chip {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-dim);
      transition: border-color .15s, color .15s;
      white-space: nowrap;
    }
    .selector-chip:hover { border-color: var(--border2); color: var(--text); }
    .selector-chip svg  { flex-shrink: 0; opacity: .7; }

    .selector-chip .chip-label {
      max-width: 140px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chip-caret {
      opacity: .5;
      font-size: 9px;
      margin-left: 2px;
    }

    .multiplier-chip {
      padding: 5px 10px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-dim);
      cursor: default;
    }

    .btn-start {
      padding: 8px 20px;
      background: var(--accent2);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      font-family: inherit;
      white-space: nowrap;
      transition: opacity .15s, transform .1s;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }
    .btn-start:hover    { opacity: .88; }
    .btn-start:active   { transform: scale(.97); }
    .btn-start:disabled { opacity: .35; cursor: not-allowed; }

    /* â”€â”€ HÄ±zlÄ± Ã¶rnekler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .quick-section {
      width: 100%;
      max-width: 680px;
    }

    .quick-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: .8px;
      margin-bottom: 10px;
    }

    .quick-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .quick-chip {
      padding: 6px 12px;
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-family: inherit;
      color: var(--text-dim);
      transition: border-color .15s, color .15s, background .15s;
    }
    .quick-chip:hover { border-color: var(--accent); color: var(--text); background: rgba(124,58,237,.06); }

    /* â”€â”€ Sohbet alanÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #chat-panel {
      display: none;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }

    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 0;
      scroll-behavior: smooth;
    }
    #messages::-webkit-scrollbar       { width: 4px; }
    #messages::-webkit-scrollbar-track { background: transparent; }
    #messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    /* â”€â”€ Mesaj balonu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .message {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border);
      animation: fadeIn .16s ease;
      max-width: 100%;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0);   }
    }

    .message-user  { background: var(--bg2); }
    .message-sidar { background: var(--bg); }

    .msg-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-dim);
    }

    .msg-avatar {
      width: 22px;
      height: 22px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .avatar-user  { background: var(--bg4); color: var(--text-dim); }
    .avatar-sidar { background: linear-gradient(135deg, var(--accent2), var(--accent)); color: #fff; }

    .msg-body { color: var(--text); word-break: break-word; max-width: 800px; }
    .msg-body p              { margin-bottom: 10px; }
    .msg-body p:last-child   { margin-bottom: 0; }
    .msg-body h1,.msg-body h2,.msg-body h3 { margin: 14px 0 6px; color: var(--text); }
    .msg-body ul,.msg-body ol { padding-left: 22px; margin: 6px 0; }
    .msg-body li             { margin: 3px 0; }
    .msg-body a              { color: var(--accent); text-decoration: none; }
    .msg-body a:hover        { text-decoration: underline; }
    .msg-body blockquote {
      border-left: 3px solid var(--border2);
      padding-left: 12px;
      color: var(--text-dim);
      margin: 8px 0;
    }
    .msg-body :not(pre) > code {
      background: var(--bg4);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 12.5px;
      color: var(--accent);
    }
    .msg-body pre {
      background: var(--bg3) !important;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      overflow-x: auto;
      margin: 10px 0;
    }
    .msg-body pre code {
      background: transparent !important;
      padding: 0;
      font-family: "JetBrains Mono", "Fira Code", monospace;
      font-size: 12.5px;
      color: var(--text);
    }
    .msg-body table {
      border-collapse: collapse;
      width: 100%;
      margin: 10px 0;
      font-size: 13px;
    }
    .msg-body th, .msg-body td {
      border: 1px solid var(--border);
      padding: 6px 12px;
      text-align: left;
    }
    .msg-body th { background: var(--bg3); color: var(--text-dim); }

    .streaming-text {
      font-size: 14px;
      white-space: pre-wrap;
      word-break: break-word;
      color: var(--text);
    }

    .cursor {
      display: inline-block;
      width: 2px;
      height: 1em;
      background: var(--accent);
      margin-left: 1px;
      vertical-align: text-bottom;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* â”€â”€ Alt girdi (sohbet modunda) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-footer {
      border-top: 1px solid var(--border);
      background: var(--bg2);
      padding: 12px 20px 14px;
      flex-shrink: 0;
    }

    .chat-input-wrap {
      max-width: 860px;
      margin: 0 auto;
    }

    .chat-input-box {
      display: flex;
      align-items: flex-end;
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: var(--radius);
      gap: 8px;
      padding: 8px 10px;
      transition: border-color .15s;
    }
    .chat-input-box:focus-within { border-color: var(--accent); }

    #input-area {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 14px;
      font-family: inherit;
      resize: none;
      min-height: 26px;
      max-height: 180px;
      overflow-y: auto;
      outline: none;
      line-height: 1.5;
      padding: 2px 0;
    }
    #input-area::placeholder { color: var(--text-muted); }

    #send-btn {
      padding: 6px 16px;
      background: var(--accent2);
      color: #fff;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      font-family: inherit;
      white-space: nowrap;
      height: 32px;
      transition: opacity .15s;
      flex-shrink: 0;
    }
    #send-btn:hover    { opacity: .85; }
    #send-btn:disabled { opacity: .35; cursor: not-allowed; }

    .chat-hint {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }

    /* â”€â”€ Repo seÃ§ici modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-bg {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      z-index: 200;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
    }
    .modal-bg.open { display: flex; }

    .modal-box {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      padding: 0;
      max-width: 480px;
      width: 92%;
      box-shadow: 0 16px 64px rgba(0,0,0,.6);
      overflow: hidden;
    }

    .modal-header {
      padding: 16px 20px 12px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-search {
      flex: 1;
      background: var(--bg3);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 7px 12px;
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      outline: none;
      transition: border-color .15s;
    }
    .modal-search:focus { border-color: var(--accent); }
    .modal-search::placeholder { color: var(--text-muted); }

    .modal-close-btn {
      background: transparent;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      font-size: 18px;
      padding: 4px 8px;
      border-radius: 6px;
      transition: color .15s, background .15s;
    }
    .modal-close-btn:hover { color: var(--text); background: var(--bg3); }

    .repo-list {
      max-height: 320px;
      overflow-y: auto;
      padding: 8px;
    }
    .repo-list::-webkit-scrollbar { width: 4px; }
    .repo-list::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .repo-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background .12s;
    }
    .repo-item:hover { background: var(--bg3); }
    .repo-item.selected { background: rgba(124,58,237,.15); }

    .repo-item-icon {
      width: 32px;
      height: 32px;
      background: var(--bg4);
      border-radius: 7px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 14px;
    }

    .repo-item-info { flex: 1; min-width: 0; }
    .repo-item-name { font-size: 13px; color: var(--text); font-weight: 500; }
    .repo-item-meta { font-size: 11px; color: var(--text-dim); margin-top: 1px; }

    .repo-item-check {
      color: var(--accent);
      font-size: 15px;
      opacity: 0;
      transition: opacity .12s;
    }
    .repo-item.selected .repo-item-check { opacity: 1; }

    /* â”€â”€ Durum modalÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stat-modal-box {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      padding: 22px;
      max-width: 440px;
      width: 92%;
      box-shadow: 0 16px 64px rgba(0,0,0,.6);
    }
    .stat-modal-box h3 { font-size: 14px; margin-bottom: 14px; font-weight: 600; }

    .stat-grid { display: grid; gap: 5px; }
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 7px 12px;
      background: var(--bg3);
      border-radius: 7px;
      font-size: 12.5px;
    }
    .stat-label { color: var(--text-dim); }
    .stat-val   { color: var(--text); font-weight: 500; }
    .ok   { color: var(--green); }
    .warn { color: var(--yellow); }

    .modal-footer {
      padding: 12px 20px;
      border-top: 1px solid var(--border);
    }

    .btn-modal-action {
      padding: 7px 16px;
      border: 1px solid var(--border2);
      background: transparent;
      color: var(--text-dim);
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-family: inherit;
      transition: border-color .15s, color .15s;
    }
    .btn-modal-action:hover { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 560px) {
      .nav-tabs { display: none; }
      .task-title { font-size: 18px; }
      #task-panel { padding: 28px 16px; }
      .message { padding: 12px 16px; }
    }
  </style>
</head>

<body>
<div class="app">

  <!-- Ãœst bar -->
  <div class="topbar">
    <div class="topbar-left">
      <div class="logo-icon">SI</div>
      <span class="logo-name">SÄ°DAR</span>
      <div class="topbar-divider"></div>
      <nav class="nav-tabs">
        <button class="nav-tab active" onclick="showTaskPanel()">GÃ¶revler</button>
        <button class="nav-tab" onclick="showChatPanel()">Sohbet</button>
      </nav>
    </div>
    <div class="topbar-right">
      <button class="btn-ghost" onclick="openStatus()">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor"><circle cx="6" cy="6" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M6 4v2.5L7.5 8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" fill="none"/></svg>
        Durum
      </button>
      <button class="btn-ghost danger" onclick="clearMemory()">
        <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" opacity=".7"><path d="M4.5 1.5h3a.5.5 0 0 1 .5.5v.5h2a.5.5 0 0 1 0 1H2a.5.5 0 0 1 0-1h2V2a.5.5 0 0 1 .5-.5zM3 5l.5 5h5l.5-5H3z"/></svg>
        Temizle
      </button>
    </div>
  </div>

  <!-- Ä°Ã§erik -->
  <div class="content">

    <!-- GÃ¶rev tanÄ±mlama paneli -->
    <div id="task-panel">
      <div class="task-header">
        <div class="task-title">Sidar'a bir gÃ¶rev ver</div>
        <div class="task-sub">YazÄ±lÄ±m MimarÄ± &amp; BaÅŸ MÃ¼hendis AI</div>
      </div>

      <div class="task-box">
        <textarea
          id="task-input"
          placeholder="Bir gÃ¶revi tanÄ±mla..."
          rows="4"
        ></textarea>
        <div class="task-box-footer">
          <div class="task-selectors">

            <!-- Repo seÃ§ici -->
            <div class="selector-chip" onclick="openRepoModal()" title="Depo seÃ§">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/>
              </svg>
              <span class="chip-label" id="repo-label">niluferbagevi-gif/sidar_project</span>
              <span class="chip-caret">â–¾</span>
            </div>

            <!-- Branch seÃ§ici -->
            <div class="selector-chip" onclick="openBranchModal()" title="Dal seÃ§">
              <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor">
                <path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/>
              </svg>
              <span class="chip-label" id="branch-label">main</span>
              <span class="chip-caret">â–¾</span>
            </div>

            <!-- Ã‡oÄŸaltÄ±cÄ± -->
            <div class="multiplier-chip" title="Paralel gÃ¶rev sayÄ±sÄ±">1x</div>

          </div>

          <button class="btn-start" onclick="startTask()">
            <svg width="13" height="13" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM6.5 5.25v5.5L11 8 6.5 5.25Z"/></svg>
            BaÅŸlat
          </button>
        </div>
      </div>

      <!-- HÄ±zlÄ± gÃ¶revler -->
      <div class="quick-section">
        <div class="quick-label">HÄ±zlÄ± gÃ¶revler</div>
        <div class="quick-grid">
          <button class="quick-chip" onclick="openProjectModal()">Projeler</button>
          <button class="quick-chip" onclick="quickTask('Sistem saÄŸlÄ±k raporu ver')">Sistem saÄŸlÄ±ÄŸÄ±</button>
          <button class="quick-chip" onclick="quickTask('Projeyi denetle ve hatalarÄ± raporla')">Proje denetimi</button>
          <button class="quick-chip" onclick="quickTask('Son 10 commit\'i listele')">Son commitler</button>
          <button class="quick-chip" onclick="quickTask('web\'de ara: Python async best practices 2025')">Web aramasÄ±</button>
          <button class="quick-chip" onclick="quickTask('pypi: fastapi')">PyPI bilgisi</button>
          <button class="quick-chip" onclick="quickTask('EriÅŸim seviyesi ve gÃ¼venlik durumunu gÃ¶ster')">GÃ¼venlik durumu</button>
          <button class="quick-chip" onclick="quickTask('Belge deposunu listele')">RAG belgeler</button>
        </div>
      </div>
    </div>

    <!-- Sohbet paneli -->
    <div id="chat-panel">
      <div id="messages"></div>

      <div class="chat-footer">
        <div class="chat-input-wrap">
          <div class="chat-input-box">
            <textarea
              id="input-area"
              placeholder="Sidar'a bir ÅŸey sor..."
              rows="1"
            ></textarea>
            <button id="send-btn" onclick="sendMessage()">GÃ¶nder</button>
          </div>
          <div class="chat-hint">Enter ile gÃ¶nder &nbsp;Â·&nbsp; Shift+Enter ile yeni satÄ±r</div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /app -->

<!-- Repo SeÃ§ici Modal -->
<div class="modal-bg" id="repo-modal" onclick="modalBgClose(event,'repo-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="15" height="15" viewBox="0 0 16 16" fill="var(--text-dim)">
        <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/>
      </svg>
      <input class="modal-search" id="repo-search" type="text" placeholder="Depo ara..." oninput="filterRepos(this.value)" />
      <button class="modal-close-btn" onclick="closeModal('repo-modal')">âœ•</button>
    </div>
    <div class="repo-list" id="repo-list">
      <!-- JS ile doldurulur -->
    </div>
  </div>
</div>

<!-- Branch SeÃ§ici Modal -->
<div class="modal-bg" id="branch-modal" onclick="modalBgClose(event,'branch-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="15" height="15" viewBox="0 0 16 16" fill="var(--text-dim)">
        <path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/>
      </svg>
      <input class="modal-search" id="branch-search" type="text" placeholder="Dal ara..." oninput="filterBranches(this.value)" />
      <button class="modal-close-btn" onclick="closeModal('branch-modal')">âœ•</button>
    </div>
    <div class="repo-list" id="branch-list">
      <!-- JS ile doldurulur -->
    </div>
  </div>
</div>

<!-- Proje SeÃ§ici Modal -->
<div class="modal-bg" id="project-modal" onclick="modalBgClose(event,'project-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="15" height="15" viewBox="0 0 16 16" fill="var(--text-dim)">
        <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"/>
      </svg>
      <input class="modal-search" id="project-search" type="text" placeholder="Proje ara..." oninput="filterProjects(this.value)" />
      <button class="modal-close-btn" onclick="closeModal('project-modal')">âœ•</button>
    </div>
    <div class="repo-list" id="project-list">
      <!-- JS ile doldurulur -->
    </div>
  </div>
</div>

<!-- Durum ModalÄ± -->
<div class="modal-bg" id="status-modal" onclick="modalBgClose(event,'status-modal')">
  <div class="stat-modal-box" onclick="event.stopPropagation()">
    <h3>Sistem Durumu</h3>
    <div class="stat-grid" id="stat-grid">
      <div class="stat-row"><span class="stat-label">YÃ¼kleniyorâ€¦</span></div>
    </div>
    <div class="modal-footer">
      <button class="btn-modal-action" onclick="closeModal('status-modal')">Kapat</button>
    </div>
  </div>
</div>

<script>
marked.setOptions({ breaks: true, gfm: true });

/* â”€â”€â”€ Durum â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let isStreaming = false;
let msgCounter  = 0;
let currentRepo   = 'niluferbagevi-gif/sidar_project';
let currentBranch = 'main';

const REPOS = [
  { name: 'niluferbagevi-gif/sidar_project', desc: 'YazÄ±lÄ±m MÃ¼hendisi AI', emoji: 'ğŸ¤–' },
  { name: 'niluferbagevi-gif/LotusAI',       desc: 'Lotus AI projesi',      emoji: 'ğŸŒ¸' },
];

const BRANCHES = ['main', 'develop', 'feature/ai-core', 'hotfix/web-ui'];

/* â”€â”€â”€ Panel geÃ§iÅŸleri â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showTaskPanel() {
  document.getElementById('task-panel').style.display = 'flex';
  document.getElementById('chat-panel').style.display = 'none';
  document.querySelectorAll('.nav-tab').forEach((t,i) => t.classList.toggle('active', i===0));
}

function showChatPanel() {
  document.getElementById('task-panel').style.display = 'none';
  document.getElementById('chat-panel').style.display = 'flex';
  document.querySelectorAll('.nav-tab').forEach((t,i) => t.classList.toggle('active', i===1));
  document.getElementById('input-area').focus();
}

/* â”€â”€â”€ GÃ¶rev baÅŸlat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startTask() {
  const text = document.getElementById('task-input').value.trim();
  if (!text) return;
  document.getElementById('task-input').value = '';
  showChatPanel();
  sendText(text);
}

function quickTask(text) {
  document.getElementById('task-input').value = text;
  startTask();
}

/* â”€â”€â”€ Textarea otomatik boyutlandÄ±rma â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
['task-input','input-area'].forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('input', () => {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, id === 'task-input' ? 260 : 180) + 'px';
  });
  el.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      id === 'task-input' ? startTask() : sendMessage();
    }
  });
});

/* â”€â”€â”€ Mesaj gÃ¶nderme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function sendMessage() {
  const textarea = document.getElementById('input-area');
  const text = textarea.value.trim();
  if (!text) return;
  textarea.value = '';
  textarea.style.height = 'auto';
  sendText(text);
}

async function sendText(text) {
  if (isStreaming) return;
  isStreaming = true;

  const sendBtn = document.getElementById('send-btn');
  if (sendBtn) sendBtn.disabled = true;

  appendUser(text);
  const msgId = createSidarMsg();

  let accumulated = '';
  const controller = new AbortController();
  let timeoutId = null;

  const resetTimeout = () => {
    if (timeoutId) clearTimeout(timeoutId);
    timeoutId = setTimeout(() => controller.abort(), 45000);
  };

  try {
    resetTimeout();
    const response = await fetch('/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: text }),
      signal: controller.signal
    });

    if (!response.ok) {
      finalizeMsg(msgId, `[HTTP HatasÄ±] Sunucu ${response.status} kodu dÃ¶ndÃ¼rdÃ¼.`);
      return;
    }

    const reader  = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = '';

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      resetTimeout();
      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split('\n');
      buffer = lines.pop();
      for (const line of lines) {
        if (!line.startsWith('data: ')) continue;
        try {
          const parsed = JSON.parse(line.slice(6).trim());
          if (parsed.done) break;
          if (parsed.chunk) { accumulated += parsed.chunk; updateStreaming(msgId, accumulated); }
        } catch { /* skip */ }
      }
    }
  } catch (err) {
    accumulated += err.name === 'AbortError'
      ? '\n\n[Sistem HatasÄ±: YanÄ±t zaman aÅŸÄ±mÄ±na uÄŸradÄ±.]'
      : `\n\n[BaÄŸlantÄ± HatasÄ±: ${err.message}]`;
  } finally {
    if (timeoutId) clearTimeout(timeoutId);
    finalizeMsg(msgId, accumulated);
    isStreaming = false;
    if (sendBtn) sendBtn.disabled = false;
  }
}

/* â”€â”€â”€ Mesaj yardÄ±mcÄ±larÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function escHtml(str) {
  const d = document.createElement('div');
  d.appendChild(document.createTextNode(str));
  return d.innerHTML;
}

function scrollBottom() {
  const msgs = document.getElementById('messages');
  msgs.scrollTop = msgs.scrollHeight;
}

function appendUser(text) {
  const msgs = document.getElementById('messages');
  const el = document.createElement('div');
  el.className = 'message message-user';
  el.innerHTML = `
    <div class="msg-header">
      <div class="msg-avatar avatar-user">S</div>
      <span>Sen</span>
    </div>
    <div class="msg-body" style="white-space:pre-wrap">${escHtml(text)}</div>`;
  msgs.appendChild(el);
  scrollBottom();
}

function createSidarMsg() {
  const msgs = document.getElementById('messages');
  const id   = `m${++msgCounter}`;
  const el   = document.createElement('div');
  el.className = 'message message-sidar';
  el.id = id;
  el.innerHTML = `
    <div class="msg-header">
      <div class="msg-avatar avatar-sidar">SI</div>
      <span>Sidar</span>
    </div>
    <div class="msg-body">
      <span class="streaming-text" id="${id}-txt"></span><span class="cursor" id="${id}-cur"></span>
    </div>`;
  msgs.appendChild(el);
  scrollBottom();
  return id;
}

function updateStreaming(id, rawText) {
  const span = document.getElementById(`${id}-txt`);
  if (span) span.textContent = rawText;
  scrollBottom();
}

function finalizeMsg(id, rawText) {
  const el = document.getElementById(id);
  if (!el) return;
  const body   = el.querySelector('.msg-body');
  const cursor = document.getElementById(`${id}-cur`);
  if (cursor) cursor.remove();
  body.innerHTML = marked.parse(rawText || '*(yanÄ±t alÄ±namadÄ±)*');
  body.querySelectorAll('pre code').forEach(b => hljs.highlightElement(b));
  scrollBottom();
}

/* â”€â”€â”€ Repo seÃ§ici â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openRepoModal() {
  renderRepos(REPOS);
  document.getElementById('repo-search').value = '';
  document.getElementById('repo-modal').classList.add('open');
  setTimeout(() => document.getElementById('repo-search').focus(), 50);
}

function renderRepos(list) {
  document.getElementById('repo-list').innerHTML = list.map(r => `
    <div class="repo-item ${r.name === currentRepo ? 'selected' : ''}" onclick="selectRepo('${r.name}')">
      <div class="repo-item-icon">${r.emoji}</div>
      <div class="repo-item-info">
        <div class="repo-item-name">${r.name}</div>
        <div class="repo-item-meta">${r.desc}</div>
      </div>
      <span class="repo-item-check">âœ“</span>
    </div>`).join('');
}

function filterRepos(q) {
  renderRepos(REPOS.filter(r => r.name.toLowerCase().includes(q.toLowerCase())));
}

function selectRepo(name) {
  currentRepo = name;
  document.getElementById('repo-label').textContent = name;
  closeModal('repo-modal');
}

/* â”€â”€â”€ Branch seÃ§ici â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openBranchModal() {
  renderBranches(BRANCHES);
  document.getElementById('branch-search').value = '';
  document.getElementById('branch-modal').classList.add('open');
  setTimeout(() => document.getElementById('branch-search').focus(), 50);
}

function renderBranches(list) {
  document.getElementById('branch-list').innerHTML = list.map(b => `
    <div class="repo-item ${b === currentBranch ? 'selected' : ''}" onclick="selectBranch('${b}')">
      <div class="repo-item-icon" style="font-size:18px">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="var(--text-dim)">
          <path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/>
        </svg>
      </div>
      <div class="repo-item-info">
        <div class="repo-item-name">${b}</div>
      </div>
      <span class="repo-item-check">âœ“</span>
    </div>`).join('');
}

function filterBranches(q) {
  renderBranches(BRANCHES.filter(b => b.toLowerCase().includes(q.toLowerCase())));
}

function selectBranch(name) {
  currentBranch = name;
  document.getElementById('branch-label').textContent = name;
  closeModal('branch-modal');
}

/* â”€â”€â”€ Proje seÃ§ici â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let allProjects = [];
let currentProject = null;

async function openProjectModal() {
  document.getElementById('project-modal').classList.add('open');
  document.getElementById('project-search').value = '';
  const listEl = document.getElementById('project-list');
  listEl.innerHTML = '<div style="padding:20px;color:var(--text-dim);text-align:center">TaranÄ±yorâ€¦</div>';
  try {
    const data = await (await fetch('/projects')).json();
    allProjects = data.projects || [];
    renderProjects(allProjects);
    setTimeout(() => document.getElementById('project-search').focus(), 50);
  } catch (err) {
    listEl.innerHTML = `<div style="padding:16px;color:var(--text-dim)">Hata: ${escHtml(err.message)}</div>`;
  }
}

function renderProjects(list) {
  const listEl = document.getElementById('project-list');
  if (!list.length) {
    listEl.innerHTML = '<div style="padding:20px;color:var(--text-dim);text-align:center">Proje bulunamadÄ±</div>';
    return;
  }
  listEl.innerHTML = list.map((p, i) => `
    <div class="repo-item ${currentProject && currentProject.path === p.path ? 'selected' : ''}" onclick="selectProject(${i})">
      <div class="repo-item-icon">ğŸ“</div>
      <div class="repo-item-info">
        <div class="repo-item-name">${escHtml(p.name)}</div>
        <div class="repo-item-meta">${escHtml(p.path)} &nbsp;Â·&nbsp; ${escHtml(p.type)}</div>
      </div>
      ${currentProject && currentProject.path === p.path ? '<span class="repo-item-check">âœ“</span>' : ''}
    </div>`).join('');
}

function filterProjects(q) {
  const lq = q.toLowerCase();
  renderProjects(allProjects.filter(p =>
    p.name.toLowerCase().includes(lq) || p.path.toLowerCase().includes(lq)
  ));
}

function selectProject(idx) {
  currentProject = allProjects[idx];
  closeModal('project-modal');
  quickTask(
    `Proje seÃ§ildi: ${currentProject.path}\n` +
    `Bu projenin dizin yapÄ±sÄ±nÄ± incele, ` +
    `teknoloji yÄ±ÄŸÄ±nÄ±nÄ± (${currentProject.type}) ve baÄŸÄ±mlÄ±lÄ±klarÄ±nÄ± tespit et, ` +
    `nasÄ±l yardÄ±mcÄ± olabileceÄŸimi aÃ§Ä±kla.`
  );
}

/* â”€â”€â”€ Modal yardÄ±mcÄ±larÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

function modalBgClose(e, id) {
  if (e.target === document.getElementById(id)) closeModal(id);
}

/* â”€â”€â”€ Durum modalÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function openStatus() {
  document.getElementById('status-modal').classList.add('open');
  const grid = document.getElementById('stat-grid');
  grid.innerHTML = '<div class="stat-row"><span class="stat-label">YÃ¼kleniyorâ€¦</span></div>';
  try {
    const data = await (await fetch('/status')).json();
    const row = (label, value, cls='') =>
      `<div class="stat-row">
        <span class="stat-label">${label}</span>
        <span class="stat-val ${cls}">${value}</span>
      </div>`;
    grid.innerHTML = [
      row('SÃ¼rÃ¼m',           `v${data.version}`),
      row('AI SaÄŸlayÄ±cÄ±',   `${data.provider} / ${data.model}`),
      row('EriÅŸim Seviyesi', data.access_level.toUpperCase()),
      row('Bellek',          `${data.memory_count} mesaj`),
      row('GitHub',   data.github     ? 'âœ“ BaÄŸlÄ±'         : 'âœ— BaÄŸlÄ± deÄŸil', data.github     ? 'ok' : 'warn'),
      row('Web Arama', data.web_search ? 'âœ“ Aktif'         : 'âœ— Kurulu deÄŸil', data.web_search ? 'ok' : 'warn'),
      row('RAG',       data.rag_status),
      row('Paket Bilgi', 'âœ“ PyPI + npm + GitHub', 'ok'),
    ].join('');
  } catch (err) {
    grid.innerHTML = `<div class="stat-row"><span class="stat-label">BaÄŸlantÄ± hatasÄ±: ${escHtml(err.message)}</span></div>`;
  }
}

/* â”€â”€â”€ Bellek temizle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function clearMemory() {
  if (!confirm('KonuÅŸma belleÄŸi temizlenecek. Devam edilsin mi?')) return;
  try { await fetch('/clear', { method: 'POST' }); } catch { /* ignore */ }
  document.getElementById('messages').innerHTML = '';
  showTaskPanel();
}

/* ESC ile modal kapatma */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    ['repo-modal','branch-modal','status-modal'].forEach(id => closeModal(id));
  }
});
</script>
</body>
</html>
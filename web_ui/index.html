<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SÄ°DAR â€” YazÄ±lÄ±m MÃ¼hendisi AI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:         #1a1a1a;
      --bg-left:    #141414;
      --bg-input:   #242424;
      --bg-hover:   #242424;
      --bg-active:  #2a2a2a;
      --border:     #2d2d2d;
      --border2:    #383838;
      --text:       #e2e2e2;
      --text-dim:   #888888;
      --text-muted: #555555;
      --accent:     #a78bfa;
      --accent2:    #7c3aed;
      --green:      #4ade80;
      --red:        #f87171;
      --yellow:     #fbbf24;
      --orange:     #f97316;
      --blue:       #60a5fa;
      --radius:     8px;
      --radius-lg:  12px;
      --lp-width:   290px;
    }
    [data-theme="light"] {
      --bg:         #f0f0f0;
      --bg-left:    #e8e8e8;
      --bg-input:   #ffffff;
      --bg-hover:   #e0e0e0;
      --bg-active:  #d8d8d8;
      --border:     #d0d0d0;
      --border2:    #c0c0c0;
      --text:       #1a1a1a;
      --text-dim:   #555555;
      --text-muted: #999999;
      --accent:     #7c3aed;
      --accent2:    #6d28d9;
      --green:      #16a34a;
      --red:        #dc2626;
    }

    html, body { height: 100%; overflow: hidden; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      font-size: 13px;
      line-height: 1.5;
    }

    /* â”€â”€ Uygulama kapsayÄ±cÄ±sÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SOL PANEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .left-panel {
      width: var(--lp-width);
      min-width: var(--lp-width);
      background: var(--bg-left);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Ãœst baÅŸlÄ±k */
    .lp-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 14px 10px;
      flex-shrink: 0;
    }
    .brand-logo {
      width: 22px; height: 22px;
      background: linear-gradient(135deg, #7c3aed, #a78bfa);
      border-radius: 5px;
      display: flex; align-items: center; justify-content: center;
      font-size: 9px; font-weight: 800; color: #fff;
      flex-shrink: 0;
    }
    .brand-name {
      font-size: 13px; font-weight: 600; color: var(--text);
    }
    .brand-badge {
      font-size: 10px; color: var(--text-muted);
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border2);
      border-radius: 20px;
      padding: 1px 7px;
      margin-left: 4px;
    }
    .lp-header-spacer { flex: 1; }
    .btn-icon-tiny {
      background: transparent; border: none;
      color: var(--text-muted); cursor: pointer;
      padding: 4px; border-radius: 5px;
      display: flex; align-items: center;
      transition: color .15s, background .15s;
    }
    .btn-icon-tiny:hover { color: var(--text); background: var(--bg-hover); }

    /* Prompt kutusu */
    .lp-prompt-box {
      margin: 0 10px 8px;
      background: var(--bg-input);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: border-color .2s;
      flex-shrink: 0;
    }
    .lp-prompt-box:focus-within { border-color: #555; }
    #left-prompt {
      width: 100%; min-height: 72px; max-height: 160px;
      background: transparent; border: none; outline: none;
      color: var(--text); font-size: 13px; font-family: inherit;
      resize: none; padding: 12px 14px 8px; line-height: 1.5;
    }
    #left-prompt::placeholder { color: var(--text-muted); }
    .lp-prompt-footer {
      display: flex; align-items: center;
      padding: 6px 8px 8px;
      gap: 6px;
      border-top: 1px solid var(--border);
    }
    .auto-accept-check {
      display: flex; align-items: center; gap: 5px;
      font-size: 11.5px; color: var(--text-dim);
      cursor: pointer; user-select: none;
      white-space: nowrap;
    }
    .auto-accept-check input[type="checkbox"] {
      accent-color: var(--accent2);
      width: 12px; height: 12px;
      cursor: pointer;
    }
    .auto-accept-check code {
      font-family: "SF Mono", "Fira Code", monospace;
      font-size: 10.5px;
      color: var(--text-dim);
      background: none;
    }
    .lp-pf-right { display: flex; align-items: center; gap: 5px; margin-left: auto; }
    .model-btn {
      font-size: 11.5px; color: var(--text-dim);
      background: transparent; border: none;
      cursor: pointer; padding: 3px 5px;
      border-radius: 5px; font-family: inherit;
      white-space: nowrap;
      transition: color .15s, background .15s;
    }
    .model-btn:hover { color: var(--text); background: var(--bg-hover); }
    .btn-send-round {
      width: 26px; height: 26px;
      background: var(--orange);
      border: none; border-radius: 50%;
      color: #fff; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      transition: opacity .15s, transform .1s;
    }
    .btn-send-round:hover { opacity: .88; }
    .btn-send-round:active { transform: scale(.93); }
    .btn-send-round:disabled { opacity: .35; cursor: not-allowed; }
    .btn-send-round svg { pointer-events: none; }

    /* Proje bilgi satÄ±rÄ± */
    .lp-project {
      display: flex; align-items: center;
      padding: 4px 14px 10px;
      gap: 6px; flex-shrink: 0;
    }
    .proj-item {
      display: flex; align-items: center; gap: 4px;
      font-size: 11.5px; color: var(--text-dim);
      cursor: pointer; padding: 2px 6px;
      border-radius: 5px;
      transition: color .15s, background .15s;
    }
    .proj-item:hover { color: var(--text); background: var(--bg-hover); }
    .proj-item svg { opacity: .6; flex-shrink: 0; }
    .proj-tag {
      margin-left: auto;
      display: flex; align-items: center; gap: 4px;
      font-size: 11px; color: var(--text-dim);
      padding: 2px 7px; border-radius: 5px;
      cursor: pointer;
      transition: color .15s;
    }
    .proj-tag:hover { color: var(--text); }
    .proj-tag svg { color: var(--blue); opacity: .8; }

    /* Sessions baÅŸlÄ±ÄŸÄ± */
    .lp-sessions-hdr {
      display: flex; align-items: center;
      padding: 6px 14px 4px;
      flex-shrink: 0;
    }
    .sessions-label {
      font-size: 12px; font-weight: 500; color: var(--text-dim);
      flex: 1;
    }
    .sessions-actions { display: flex; gap: 2px; }
    .btn-session-icon {
      background: transparent; border: none;
      color: var(--text-muted); cursor: pointer;
      padding: 4px 5px; border-radius: 5px;
      display: flex; align-items: center;
      font-size: 12px;
      transition: color .15s, background .15s;
    }
    .btn-session-icon:hover { color: var(--text); background: var(--bg-hover); }

    /* Session arama */
    .session-search-wrap {
      padding: 0 10px 6px; flex-shrink: 0;
    }
    .session-search {
      width: 100%;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 5px 10px;
      color: var(--text); font-size: 12px; font-family: inherit;
      outline: none;
      transition: border-color .15s;
    }
    .session-search:focus { border-color: #555; }
    .session-search::placeholder { color: var(--text-muted); }

    /* Session listesi */
    .session-list {
      flex: 1; overflow-y: auto; padding: 2px 6px 6px;
    }
    .session-list::-webkit-scrollbar { width: 3px; }
    .session-list::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    .session-item {
      padding: 7px 8px;
      border-radius: 7px;
      cursor: pointer;
      margin-bottom: 1px;
      transition: background .12s;
    }
    .session-item:hover { background: var(--bg-hover); }
    .session-item.active { background: var(--bg-active); }

    .session-item-top {
      display: flex; align-items: center; justify-content: space-between;
      gap: 6px;
    }
    .session-item-title {
      font-size: 12.5px; color: var(--text);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      flex: 1;
    }
    .session-item-delete {
      background: none; border: none;
      color: var(--text-muted); cursor: pointer;
      opacity: 0; padding: 2px;
      display: flex; border-radius: 4px;
      transition: color .15s, opacity .15s;
    }
    .session-item:hover .session-item-delete { opacity: 1; }
    .session-item-delete:hover { color: var(--red); }

    .session-item-meta {
      display: flex; align-items: center; gap: 4px;
      margin-top: 3px; font-size: 11px; color: var(--text-muted);
      overflow: hidden;
    }
    .session-item-meta svg { color: var(--blue); opacity: .7; flex-shrink: 0; }
    .meta-repo { color: var(--text-muted); }
    .meta-dot { color: var(--text-muted); opacity: .5; }
    .meta-time { color: var(--text-muted); }
    .meta-add  { color: var(--green); font-weight: 500; }
    .meta-del  { color: var(--red); font-weight: 500; }
    .meta-badge {
      background: rgba(74,222,128,.15);
      color: var(--green);
      border-radius: 20px;
      padding: 0 5px;
      font-size: 10px; font-weight: 600;
      margin-left: 2px;
    }

    /* Sol panel alt bar */
    .lp-bottom {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 12px;
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }
    .user-avatar {
      width: 26px; height: 26px;
      border-radius: 50%;
      background: #444; color: var(--text);
      border: none; cursor: pointer;
      font-size: 12px; font-weight: 600;
      display: flex; align-items: center; justify-content: center;
      transition: background .15s;
    }
    .user-avatar:hover { background: #555; }
    .lp-bottom-right { display: flex; gap: 4px; }
    .btn-bottom-icon {
      background: transparent; border: none;
      color: var(--text-muted); cursor: pointer;
      padding: 4px; border-radius: 5px;
      display: flex; align-items: center;
      transition: color .15s, background .15s;
    }
    .btn-bottom-icon:hover { color: var(--text); background: var(--bg-hover); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SAÄ PANEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .right-panel {
      flex: 1; min-width: 0;
      display: flex; flex-direction: column;
      overflow: hidden;
      background: var(--bg);
    }

    /* SaÄŸ panel baÅŸlÄ±ÄŸÄ± */
    .rp-header {
      display: flex; align-items: center;
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--bg);
      flex-shrink: 0; gap: 10px;
    }
    .rp-title-wrap {
      display: flex; align-items: center; gap: 5px;
      min-width: 0; flex: 1;
    }
    .rp-title {
      font-size: 13px; font-weight: 500; color: var(--text);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .rp-caret {
      background: transparent; border: none;
      color: var(--text-muted); cursor: pointer; padding: 2px 3px;
      font-size: 11px; border-radius: 4px;
      transition: color .15s;
      flex-shrink: 0;
    }
    .rp-caret:hover { color: var(--text); }
    .rp-header-right { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
    .btn-rp-icon {
      background: transparent; border: none;
      color: var(--text-muted); cursor: pointer;
      padding: 4px 6px; border-radius: 5px; font-size: 13px;
      display: flex; align-items: center;
      transition: color .15s, background .15s;
    }
    .btn-rp-icon:hover { color: var(--text); background: var(--bg-hover); }
    .btn-share {
      padding: 4px 12px;
      border: 1px solid var(--border2);
      background: transparent; color: var(--text-dim);
      border-radius: 6px; font-size: 12px;
      font-family: inherit; cursor: pointer;
      display: flex; align-items: center; gap: 5px;
      transition: border-color .15s, color .15s, background .15s;
    }
    .btn-share:hover { border-color: #555; color: var(--text); background: var(--bg-hover); }

    /* Mesajlar */
    #messages {
      flex: 1; overflow-y: auto; padding: 0;
      scroll-behavior: smooth;
    }
    #messages::-webkit-scrollbar { width: 4px; }
    #messages::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    /* BoÅŸ durum */
    .empty-state {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100%; gap: 12px;
      color: var(--text-muted);
    }
    .empty-state-icon {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, var(--accent2), var(--accent));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; font-weight: 800; color: #fff;
    }
    .empty-state p { font-size: 13px; color: var(--text-muted); text-align: center; }

    /* Mesaj balonu */
    .message {
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      animation: fadeUp .15s ease;
    }
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(4px); }
      to   { opacity:1; transform:translateY(0); }
    }
    .message-user  { background: var(--bg-input); }
    .message-sidar { background: var(--bg); }

    .msg-header {
      display: flex; align-items: center; gap: 7px;
      margin-bottom: 7px; font-size: 11.5px; font-weight: 600;
      color: var(--text-dim);
    }
    .msg-avatar {
      width: 20px; height: 20px; border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      font-size: 9px; font-weight: 700; flex-shrink: 0;
    }
    .avatar-user  { background: #444; color: var(--text-dim); }
    .avatar-sidar { background: linear-gradient(135deg, var(--accent2), var(--accent)); color: #fff; }

    .msg-body { color: var(--text); word-break: break-word; max-width: 860px; }
    .msg-body p              { margin-bottom: 9px; }
    .msg-body p:last-child   { margin-bottom: 0; }
    .msg-body h1,.msg-body h2,.msg-body h3 { margin: 12px 0 5px; }
    .msg-body ul,.msg-body ol { padding-left: 20px; margin: 5px 0; }
    .msg-body li             { margin: 2px 0; }
    .msg-body a              { color: var(--accent); text-decoration: none; }
    .msg-body a:hover        { text-decoration: underline; }
    .msg-body blockquote {
      border-left: 3px solid var(--border2);
      padding-left: 12px; color: var(--text-dim); margin: 7px 0;
    }
    .msg-body :not(pre) > code {
      background: rgba(255,255,255,.08);
      padding: 1px 5px; border-radius: 4px;
      font-family: "SF Mono","Fira Code",monospace; font-size: 12px;
      color: var(--accent);
    }
    [data-theme="light"] .msg-body :not(pre) > code { background: rgba(0,0,0,.07); }
    .msg-body pre {
      background: #111 !important; border: 1px solid var(--border);
      border-radius: var(--radius); padding: 12px 14px;
      overflow-x: auto; margin: 8px 0;
    }
    [data-theme="light"] .msg-body pre { background: #f5f5f5 !important; }
    .msg-body pre code {
      background: transparent !important; padding: 0;
      font-family: "SF Mono","Fira Code",monospace; font-size: 12px;
    }
    .msg-body table { border-collapse: collapse; width: 100%; margin: 8px 0; font-size: 12.5px; }
    .msg-body th, .msg-body td { border: 1px solid var(--border); padding: 5px 10px; text-align: left; }
    .msg-body th { background: rgba(255,255,255,.05); color: var(--text-dim); }

    .streaming-text { font-size: 13px; white-space: pre-wrap; word-break: break-word; }
    .cursor {
      display: inline-block; width: 2px; height: 1em;
      background: var(--accent); margin-left: 1px;
      vertical-align: text-bottom; animation: blink 1s step-end infinite;
    }
    @keyframes blink { 50% { opacity:0; } }

    .msg-actions {
      display: flex; gap: 4px; margin-top: 7px;
      opacity: 0; transition: opacity .15s;
    }
    .message:hover .msg-actions { opacity: 1; }
    .msg-action-btn {
      padding: 2px 8px; background: transparent;
      border: 1px solid var(--border); border-radius: 5px;
      color: var(--text-muted); font-size: 11px; cursor: pointer;
      font-family: inherit;
      transition: color .15s, border-color .15s;
    }
    .msg-action-btn:hover { color: var(--accent); border-color: var(--accent); }

    /* Kod kopyala */
    .code-wrap { position: relative; }
    .copy-btn {
      position: absolute; top: 7px; right: 7px;
      padding: 2px 7px; background: rgba(255,255,255,.08);
      border: 1px solid var(--border2); border-radius: 4px;
      color: var(--text-dim); font-size: 11px; cursor: pointer;
      opacity: 0; transition: opacity .15s, color .15s;
      font-family: inherit; display: flex; align-items: center; gap: 3px;
    }
    .code-wrap:hover .copy-btn { opacity: 1; }
    .copy-btn:hover { color: var(--accent); border-color: var(--accent); }
    .copy-btn.copied { color: var(--green); border-color: var(--green); opacity: 1; }

    /* PR bar */
    .pr-bar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 6px 16px; background: var(--bg);
      border-top: 1px solid var(--border);
      flex-shrink: 0; gap: 10px;
    }
    .pr-bar[hidden] { display: none; }
    .pr-bar-left { display: flex; align-items: center; gap: 8px; min-width: 0; overflow: hidden; }
    .pr-bar-left svg { color: var(--green); flex-shrink: 0; }
    .pr-ref {
      font-size: 12px; color: var(--text-dim);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .pr-ref-base { color: var(--text); }
    .pr-ref-arrow { color: var(--text-muted); margin: 0 3px; }
    .pr-ref-head { color: var(--text); }
    .pr-diff { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
    .pr-add { font-size: 11.5px; color: var(--green); font-weight: 600; }
    .pr-del { font-size: 11.5px; color: var(--red); font-weight: 600; }
    .btn-view-pr {
      padding: 3px 10px; background: transparent;
      border: 1px solid var(--border2); color: var(--text-dim);
      border-radius: 5px; font-size: 11.5px; font-weight: 500;
      font-family: inherit; cursor: pointer; flex-shrink: 0;
      transition: border-color .15s, color .15s;
    }
    .btn-view-pr:hover { border-color: #555; color: var(--text); }

    /* SaÄŸ panel input alanÄ± */
    .rp-input-wrapper {
      border-top: 1px solid var(--border);
      background: var(--bg);
      flex-shrink: 0; padding: 10px 14px 0;
    }
    .rp-input-box {
      background: var(--bg-input);
      border: 1px solid var(--border2);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: border-color .2s;
    }
    .rp-input-box:focus-within { border-color: #555; }

    #attached-file-preview { padding: 0 14px; }
    .attached-file {
      display: flex; align-items: center; gap: 5px;
      padding: 3px 8px; background: rgba(255,255,255,.07);
      border: 1px solid var(--border2); border-radius: 5px;
      font-size: 11.5px; color: var(--text-dim);
      margin: 6px 0 0; max-width: 280px;
    }
    .attached-file-remove {
      cursor: pointer; color: var(--text-muted);
      margin-left: auto; font-size: 13px; line-height: 1;
      background: none; border: none; padding: 0 2px;
    }
    .attached-file-remove:hover { color: var(--red); }

    #input-area {
      width: 100%; background: transparent; border: none; outline: none;
      color: var(--text); font-size: 13px; font-family: inherit;
      resize: none; min-height: 52px; max-height: 200px;
      overflow-y: auto; line-height: 1.5;
      padding: 12px 14px 8px;
    }
    #input-area::placeholder { color: var(--text-muted); }

    .rp-input-footer {
      display: flex; align-items: center;
      padding: 6px 8px 8px; gap: 6px;
      border-top: 1px solid var(--border);
    }
    .rp-footer-left { display: flex; align-items: center; gap: 4px; }
    .rp-footer-right { display: flex; align-items: center; gap: 5px; margin-left: auto; }

    .btn-attach-plus {
      width: 24px; height: 24px;
      background: var(--bg-hover); border: 1px solid var(--border2);
      border-radius: 5px; color: var(--text-dim); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px; line-height: 1;
      transition: color .15s, background .15s;
      flex-shrink: 0; padding: 0;
    }
    .btn-attach-plus:hover { color: var(--text); background: var(--bg-active); }
    .btn-attach-plus label { cursor: pointer; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; }

    #stop-btn {
      padding: 4px 10px; background: transparent;
      border: 1px solid var(--red); color: var(--red);
      border-radius: 5px; font-size: 11.5px; font-weight: 600;
      font-family: inherit; cursor: pointer; white-space: nowrap;
      display: none; align-items: center; gap: 4px;
      transition: background .15s;
    }
    #stop-btn:hover { background: rgba(248,113,113,.1); }
    #send-btn { /* use btn-send-round */ }

    /* SaÄŸ panel status bar */
    .rp-status-bar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 6px 14px 8px;
    }
    .status-tag {
      display: flex; align-items: center; gap: 5px;
      font-size: 11px; color: var(--text-muted);
    }
    .status-tag svg { color: var(--blue); opacity: .8; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODALLER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .modal-bg {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,.7); z-index: 200;
      align-items: center; justify-content: center;
      backdrop-filter: blur(4px);
    }
    .modal-bg.open { display: flex; }
    .modal-box {
      background: #1e1e1e; border: 1px solid var(--border2);
      border-radius: var(--radius-lg); padding: 0;
      max-width: 480px; width: 92%;
      box-shadow: 0 20px 60px rgba(0,0,0,.7); overflow: hidden;
    }
    [data-theme="light"] .modal-box { background: #fff; }
    .modal-header {
      padding: 14px 16px 10px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 8px;
    }
    .modal-search {
      flex: 1; background: var(--bg-input); border: 1px solid var(--border2);
      border-radius: 7px; padding: 6px 10px; color: var(--text);
      font-size: 12.5px; font-family: inherit; outline: none;
      transition: border-color .15s;
    }
    .modal-search:focus { border-color: #555; }
    .modal-search::placeholder { color: var(--text-muted); }
    .modal-close-btn {
      background: transparent; border: none; color: var(--text-dim);
      cursor: pointer; font-size: 16px; padding: 3px 7px;
      border-radius: 5px; transition: color .15s, background .15s;
    }
    .modal-close-btn:hover { color: var(--text); background: var(--bg-hover); }
    .repo-list { max-height: 300px; overflow-y: auto; padding: 6px; }
    .repo-list::-webkit-scrollbar { width: 3px; }
    .repo-list::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
    .repo-item {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 10px; border-radius: 7px; cursor: pointer;
      transition: background .12s;
    }
    .repo-item:hover { background: var(--bg-hover); }
    .repo-item.selected { background: rgba(124,58,237,.12); }
    .repo-item-icon {
      width: 30px; height: 30px; background: var(--bg-active);
      border-radius: 6px; display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; font-size: 14px;
    }
    .repo-item-info { flex: 1; min-width: 0; }
    .repo-item-name { font-size: 12.5px; color: var(--text); font-weight: 500; }
    .repo-item-meta { font-size: 11px; color: var(--text-dim); margin-top: 1px; }
    .repo-item-check { color: var(--accent); font-size: 14px; opacity: 0; }
    .repo-item.selected .repo-item-check { opacity: 1; }

    /* Durum modalÄ± */
    .stat-modal-box {
      background: #1e1e1e; border: 1px solid var(--border2);
      border-radius: var(--radius-lg); padding: 20px;
      max-width: 420px; width: 92%;
      box-shadow: 0 20px 60px rgba(0,0,0,.7);
    }
    [data-theme="light"] .stat-modal-box { background: #fff; }
    .stat-modal-box h3 { font-size: 13.5px; margin-bottom: 12px; font-weight: 600; }
    .stat-grid { display: grid; gap: 4px; }
    .stat-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 6px 10px; background: rgba(255,255,255,.04);
      border-radius: 6px; font-size: 12px;
    }
    [data-theme="light"] .stat-row { background: rgba(0,0,0,.04); }
    .stat-label { color: var(--text-dim); }
    .stat-val   { color: var(--text); font-weight: 500; }
    .ok   { color: var(--green); } .warn { color: var(--yellow); }
    .modal-footer { padding: 12px 0 0; border-top: 1px solid var(--border); margin-top: 10px; }
    .btn-modal-action {
      padding: 5px 12px; border: 1px solid var(--border2);
      background: transparent; color: var(--text-dim);
      border-radius: 6px; cursor: pointer; font-size: 12px;
      font-family: inherit; transition: border-color .15s, color .15s;
    }
    .btn-modal-action:hover { border-color: #555; color: var(--text); }

    /* KÄ±sayollar modalÄ± */
    .shortcuts-modal-box {
      background: #1e1e1e; border: 1px solid var(--border2);
      border-radius: var(--radius-lg); padding: 20px;
      max-width: 400px; width: 92%;
      box-shadow: 0 20px 60px rgba(0,0,0,.7);
    }
    [data-theme="light"] .shortcuts-modal-box { background: #fff; }
    .shortcuts-modal-box h3 { font-size: 13.5px; margin-bottom: 12px; font-weight: 600; }
    .shortcut-section { margin-bottom: 12px; }
    .shortcut-section-title { font-size: 10px; text-transform: uppercase; letter-spacing: .7px; color: var(--text-muted); margin-bottom: 5px; }
    .shortcut-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 5px 8px; background: rgba(255,255,255,.04);
      border-radius: 5px; margin-bottom: 2px; font-size: 12px;
    }
    [data-theme="light"] .shortcut-row { background: rgba(0,0,0,.04); }
    .shortcut-key { display: flex; gap: 3px; }
    .kbd {
      background: rgba(255,255,255,.08); border: 1px solid var(--border2);
      border-radius: 3px; padding: 1px 5px; font-size: 10.5px;
      font-family: "SF Mono","Fira Code",monospace; color: var(--accent);
    }
    [data-theme="light"] .kbd { background: rgba(0,0,0,.07); }
    .shortcut-desc { color: var(--text-dim); }

    /* Responsive */
    @media (max-width: 680px) {
      .left-panel { display: none; }
    }
  </style>
</head>
<body>
<div class="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SOL PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="left-panel">

    <!-- BaÅŸlÄ±k -->
    <div class="lp-header">
      <div class="brand-logo">SI</div>
      <span class="brand-name">SÄ°DAR</span>
      <span class="brand-badge">Research preview</span>
      <div class="lp-header-spacer"></div>
      <button class="btn-icon-tiny" onclick="toggleTheme()" id="theme-btn" title="Tema">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.05 8.05 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.38 8.38 0 0 1 .08-1.05A1 1 0 0 0 7.92 3.32a10.14 10.14 0 1 0 13.35 13.35 1 1 0 0 0-.48-1.67Z"/></svg>
      </button>
      <button class="btn-icon-tiny" onclick="openShortcuts()" title="KÄ±sayollar">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M6 10h.01M10 10h.01M14 10h.01M18 10h.01M8 14h8"/></svg>
      </button>
      <button class="btn-icon-tiny" title="DÃ¼zen">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="18" rx="1"/><rect x="14" y="3" width="7" height="18" rx="1"/></svg>
      </button>
    </div>

    <!-- Prompt kutusu -->
    <div class="lp-prompt-box">
      <textarea id="left-prompt" placeholder="Ask Claude to write code..." rows="3"></textarea>
      <div class="lp-prompt-footer">
        <label class="auto-accept-check">
          <input type="checkbox" id="auto-accept-toggle" onchange="handleAutoAcceptChange(this.checked)">
          <code>&lt;&gt;</code> Auto accept edits
        </label>
        <div class="lp-pf-right">
          <button class="model-btn" id="sidebar-model-name" onclick="openStatus()">YÃ¼kleniyorâ€¦ â–¾</button>
          <button class="btn-send-round" id="left-send-btn" onclick="startFromLeftPrompt()" title="GÃ¶nder">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Proje bilgisi -->
    <div class="lp-project">
      <span class="proj-item" onclick="openRepoModal()" title="Depo seÃ§">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/></svg>
        <span id="repo-label">niluferbagevi-gif/sidar_project</span>
      </span>
      <span class="proj-item" onclick="openBranchModal()" title="Dal seÃ§">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg>
        <span id="branch-label">main</span>
      </span>
      <span class="proj-tag" onclick="openStatus()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M19.5 1.5a3 3 0 0 1 3 3v15a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3v-15a3 3 0 0 1 3-3h15Zm-10.5 9.75a.75.75 0 0 0 0 1.5h1.5V15a.75.75 0 0 0 1.5 0v-2.25H13.5a.75.75 0 0 0 0-1.5H12V9a.75.75 0 0 0-1.5 0v2.25H9Z"/></svg>
        <span id="proj-tag-text">deneme</span>
      </span>
    </div>

    <!-- Sessions baÅŸlÄ±ÄŸÄ± -->
    <div class="lp-sessions-hdr">
      <span class="sessions-label">Sessions</span>
      <div class="sessions-actions">
        <button class="btn-session-icon" onclick="toggleSessionSearch()" title="Ara">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </button>
        <button class="btn-session-icon" onclick="createNewSession()" title="Yeni sohbet">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        </button>
      </div>
    </div>

    <!-- Session arama (gizli baÅŸlangÄ±Ã§ta) -->
    <div class="session-search-wrap" id="session-search-wrap" style="display:none">
      <input class="session-search" id="session-search" type="text"
        placeholder="Sohbetlerde araâ€¦" oninput="filterSessions(this.value)" />
    </div>

    <!-- Session listesi -->
    <div class="session-list" id="session-list"></div>

    <!-- Alt bar -->
    <div class="lp-bottom">
      <button class="user-avatar" onclick="openStatus()" title="Profil">S</button>
      <div class="lp-bottom-right">
        <button class="btn-bottom-icon" onclick="clearMemory()" title="BelleÄŸi temizle">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 1.5h3a.5.5 0 0 1 .5.5v.5h2a.5.5 0 0 1 0 1H2a.5.5 0 0 1 0-1h2V2a.5.5 0 0 1 .5-.5zM3 5l.5 5h5l.5-5H3z"/></svg>
        </button>
        <button class="btn-bottom-icon" onclick="openStatus()" title="Durum">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v4m0 4h.01"/></svg>
        </button>
      </div>
    </div>
  </div><!-- /left-panel -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SAÄ PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="right-panel">

    <!-- BaÅŸlÄ±k -->
    <div class="rp-header">
      <div class="rp-title-wrap">
        <span class="rp-title" id="right-title">SÄ°DAR â€” YazÄ±lÄ±m MÃ¼hendisi AI</span>
        <button class="rp-caret" onclick="createNewSession()" title="Yeni oturum">â–¾</button>
      </div>
      <div class="rp-header-right">
        <button class="btn-rp-icon" onclick="openStatus()" title="Durum">
          <svg width="13" height="13" viewBox="0 0 12 12" fill="currentColor"><circle cx="6" cy="6" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M6 4v2.5L7.5 8" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" fill="none"/></svg>
        </button>
        <button class="btn-share" onclick="shareSession()">
          <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
          Share
        </button>
      </div>
    </div>

    <!-- Mesajlar -->
    <div id="messages">
      <div class="empty-state" id="empty-state">
        <div class="empty-state-icon">SI</div>
        <p>Sol taraftaki kutuya bir gÃ¶rev yazÄ±n<br>veya sohbet alanÄ±ndan mesaj gÃ¶nderin</p>
      </div>
    </div>

    <!-- PR / Git bar -->
    <div class="pr-bar" id="pr-bar" hidden>
      <div class="pr-bar-left">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="color:var(--green)">
          <path d="M1.5 3.25a2.25 2.25 0 1 1 3 2.122v5.256a2.251 2.251 0 1 1-1.5 0V5.372A2.25 2.25 0 0 1 1.5 3.25Zm5.677-.177L9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM3.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm0 9.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm8.25.75a.75.75 0 1 0 1.5 0 .75.75 0 0 0-1.5 0Z"/>
        </svg>
        <span class="pr-ref">
          <span class="pr-ref-base" id="pr-base">main</span>
          <span class="pr-ref-arrow">â†</span>
          <span class="pr-ref-head" id="pr-head">claude/branch</span>
        </span>
      </div>
      <div style="display:flex;align-items:center;gap:10px;flex-shrink:0">
        <div class="pr-diff">
          <span class="pr-add" id="pr-add">+0</span>
          <span class="pr-del" id="pr-del">-0</span>
        </div>
        <button class="btn-view-pr" onclick="viewPR()">View PR</button>
      </div>
    </div>

    <!-- Input alanÄ± -->
    <div class="rp-input-wrapper">
      <div class="rp-input-box">
        <div id="attached-file-preview"></div>
        <textarea id="input-area" placeholder="Sidar'a bir ÅŸey sorâ€¦" rows="1"></textarea>
        <div class="rp-input-footer">
          <div class="rp-footer-left">
            <button class="btn-attach-plus" title="Dosya ekle">
              <label>
                +<input type="file" id="file-input" style="display:none"
                  accept=".txt,.md,.py,.js,.ts,.json,.yaml,.yml,.toml,.csv,.html,.css,.sh,.go,.rs,.java,.c,.cpp"
                  onchange="handleFileAttach(event)" />
              </label>
            </button>
            <label class="auto-accept-check">
              <input type="checkbox" id="auto-accept-toggle-footer" onchange="handleAutoAcceptChange(this.checked)">
              <code>&lt;&gt;</code> Auto accept edits
            </label>
          </div>
          <div class="rp-footer-right">
            <button id="stop-btn" onclick="stopStreaming()" title="Durdur">
              <svg width="9" height="9" viewBox="0 0 10 10" fill="currentColor"><rect width="10" height="10" rx="2"/></svg>
              Durdur
            </button>
            <button class="model-btn" id="footer-model-name" onclick="openStatus()">YÃ¼kleniyorâ€¦ â–¾</button>
            <button class="btn-send-round" id="send-btn" onclick="sendMessage()" title="GÃ¶nder">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
            </button>
          </div>
        </div>
      </div>
      <!-- Status bar -->
      <div class="rp-status-bar">
        <span class="status-tag">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M19.5 1.5a3 3 0 0 1 3 3v15a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3v-15a3 3 0 0 1 3-3h15Zm-10.5 9.75a.75.75 0 0 0 0 1.5h1.5V15a.75.75 0 0 0 1.5 0v-2.25H13.5a.75.75 0 0 0 0-1.5H12V9a.75.75 0 0 0-1.5 0v2.25H9Z"/></svg>
          <span id="status-tag-text">deneme</span>
        </span>
        <button class="btn-icon-tiny" title="DÃ¼zen">
          <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="18" rx="1"/><rect x="14" y="3" width="7" height="18" rx="1"/></svg>
        </button>
      </div>
    </div>
  </div><!-- /right-panel -->

</div><!-- /app -->

<!-- â•â•â• MODAL: Repo â•â•â• -->
<div class="modal-bg" id="repo-modal" onclick="modalBgClose(event,'repo-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8V1.5Z"/></svg>
      <input class="modal-search" id="repo-search" type="text" placeholder="Depo ara..." oninput="filterRepos(this.value)" />
      <button class="modal-close-btn" onclick="closeModal('repo-modal')">âœ•</button>
    </div>
    <div class="repo-list" id="repo-list"></div>
  </div>
</div>

<!-- â•â•â• MODAL: Branch â•â•â• -->
<div class="modal-bg" id="branch-modal" onclick="modalBgClose(event,'branch-modal')">
  <div class="modal-box" onclick="event.stopPropagation()">
    <div class="modal-header">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg>
      <input class="modal-search" id="branch-search" type="text" placeholder="Dal ara..." oninput="filterBranches(this.value)" />
      <button class="modal-close-btn" onclick="closeModal('branch-modal')">âœ•</button>
    </div>
    <div class="repo-list" id="branch-list"></div>
  </div>
</div>

<!-- â•â•â• MODAL: Durum â•â•â• -->
<div class="modal-bg" id="status-modal" onclick="modalBgClose(event,'status-modal')">
  <div class="stat-modal-box" onclick="event.stopPropagation()">
    <h3>Sistem Durumu</h3>
    <div class="stat-grid" id="stat-grid"><div class="stat-row"><span class="stat-label">YÃ¼kleniyorâ€¦</span></div></div>
    <div class="modal-footer"><button class="btn-modal-action" onclick="closeModal('status-modal')">Kapat</button></div>
  </div>
</div>

<!-- â•â•â• MODAL: KÄ±sayollar â•â•â• -->
<div class="modal-bg" id="shortcuts-modal" onclick="modalBgClose(event,'shortcuts-modal')">
  <div class="shortcuts-modal-box" onclick="event.stopPropagation()">
    <h3>Klavye KÄ±sayollarÄ±</h3>
    <div class="shortcut-section">
      <div class="shortcut-section-title">MesajlaÅŸma</div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Enter</span></div><span class="shortcut-desc">Mesaj gÃ¶nder</span></div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Shift</span><span class="kbd">Enter</span></div><span class="shortcut-desc">Yeni satÄ±r</span></div>
    </div>
    <div class="shortcut-section">
      <div class="shortcut-section-title">ArayÃ¼z</div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Esc</span></div><span class="shortcut-desc">ModalÄ± kapat / Durdur</span></div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Ctrl</span><span class="kbd">K</span></div><span class="shortcut-desc">Yeni sohbet</span></div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Ctrl</span><span class="kbd">T</span></div><span class="shortcut-desc">Tema deÄŸiÅŸtir</span></div>
      <div class="shortcut-row"><div class="shortcut-key"><span class="kbd">Ctrl</span><span class="kbd">L</span></div><span class="shortcut-desc">BelleÄŸi temizle</span></div>
    </div>
    <div class="modal-footer"><button class="btn-modal-action" onclick="closeModal('shortcuts-modal')">Kapat</button></div>
  </div>
</div>

<script>
marked.setOptions({ breaks: true, gfm: true });

/* â”€â”€â”€ DeÄŸiÅŸkenler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let isStreaming      = false;
let msgCounter       = 0;
let activeController = null;
let currentRepo      = 'niluferbagevi-gif/sidar_project';
let currentBranch    = 'main';
let currentSessionId = null;
let attachedFileContent = null;
let attachedFileName    = null;
let allSessions      = [];
let autoAcceptEnabled = false;
let currentPRUrl     = null;

const REPOS = [
  { name: 'niluferbagevi-gif/sidar_project', desc: 'YazÄ±lÄ±m MÃ¼hendisi AI', emoji: 'ğŸ¤–' },
  { name: 'niluferbagevi-gif/LotusAI',       desc: 'Lotus AI projesi',      emoji: 'ğŸŒ¸' },
];
const BRANCHES = ['main', 'develop', 'feature/ai-core', 'hotfix/web-ui'];

/* â”€â”€â”€ BaÅŸlangÄ±Ã§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.addEventListener('DOMContentLoaded', async () => {
  applyStoredTheme();
  applyStoredAutoAccept();
  await Promise.all([loadStatus(), loadSessions()]);
  if (currentSessionId) await loadSessionHistory(currentSessionId, false);
});

/* â”€â”€â”€ Tema â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleTheme() {
  const html = document.documentElement;
  const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', next);
  localStorage.setItem('sidar-theme', next);
}
function applyStoredTheme() {
  const saved = localStorage.getItem('sidar-theme') || 'dark';
  document.documentElement.setAttribute('data-theme', saved);
}

/* â”€â”€â”€ Auto Accept â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function applyStoredAutoAccept() {
  const saved = localStorage.getItem('sidar-auto-accept') === 'true';
  autoAcceptEnabled = saved;
  ['auto-accept-toggle','auto-accept-toggle-footer'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.checked = saved;
  });
}
function handleAutoAcceptChange(val) {
  autoAcceptEnabled = val;
  localStorage.setItem('sidar-auto-accept', val);
  ['auto-accept-toggle','auto-accept-toggle-footer'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.checked = val;
  });
}

/* â”€â”€â”€ Status yÃ¼kleme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadStatus() {
  try {
    const data = await (await fetch('/status')).json();
    const modelName = data.model || data.provider || 'Sidar AI';
    const shortModel = modelName.length > 20 ? modelName.slice(0,20)+'â€¦' : modelName;
    document.getElementById('sidebar-model-name').textContent = shortModel + ' â–¾';
    document.getElementById('footer-model-name').textContent  = shortModel + ' â–¾';
  } catch {
    document.getElementById('sidebar-model-name').textContent = 'Sidar AI â–¾';
    document.getElementById('footer-model-name').textContent  = 'Sidar AI â–¾';
  }
}

/* â”€â”€â”€ Session arama toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toggleSessionSearch() {
  const wrap = document.getElementById('session-search-wrap');
  const isHidden = wrap.style.display === 'none';
  wrap.style.display = isHidden ? 'block' : 'none';
  if (isHidden) document.getElementById('session-search').focus();
}

/* â”€â”€â”€ Oturumlar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadSessions() {
  try {
    const res  = await fetch('/sessions');
    const data = await res.json();
    currentSessionId = data.active_session;
    allSessions = data.sessions || [];
    renderSessionList(allSessions);
  } catch (err) { console.error("Oturumlar yÃ¼klenemedi:", err); }
}

function renderSessionList(sessions) {
  const listEl = document.getElementById('session-list');
  listEl.innerHTML = '';
  if (!sessions || sessions.length === 0) return;
  sessions.forEach(s => {
    const isActive = s.id === currentSessionId;
    const div = document.createElement('div');
    div.className = `session-item ${isActive ? 'active' : ''}`;
    div.onclick = () => selectSession(s.id);

    const added   = s.lines_added   ?? null;
    const removed = s.lines_removed ?? null;
    const count   = s.message_count ?? null;
    const dateStr = formatRelativeTime(s.updated_at || s.created_at || null);
    const repoShort = (s.repo || currentRepo || '').split('/').pop() || '';

    const diffHtml = (added !== null && removed !== null && (added + removed) > 0)
      ? `<span class="meta-dot">Â·</span><span class="meta-add">+${added}</span><span class="meta-del">-${removed}</span>`
      : '';
    const badgeHtml = count > 0
      ? `<span class="meta-badge">${count}</span>` : '';

    div.innerHTML = `
      <div class="session-item-top">
        <div class="session-item-title" title="${escHtml(s.title)}">${escHtml(s.title)}</div>
        <button class="session-item-delete" onclick="deleteSession('${s.id}', event)" title="Sil">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 1a.5.5 0 0 0-.5.5v1h6v-1a.5.5 0 0 0-.5-.5h-5ZM2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-1v9a2 2 0 0 1-2 2h-5a2 2 0 0 1-2-2v-9h-1a.5.5 0 0 1-.5-.5Zm3 1v9a1 1 0 0 0 1 1h5a1 1 0 0 0 1-1v-9H5Z"/></svg>
        </button>
      </div>
      <div class="session-item-meta">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="currentColor"><path d="M19.5 1.5a3 3 0 0 1 3 3v15a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3v-15a3 3 0 0 1 3-3h15Zm-10.5 9.75a.75.75 0 0 0 0 1.5h1.5V15a.75.75 0 0 0 1.5 0v-2.25H13.5a.75.75 0 0 0 0-1.5H12V9a.75.75 0 0 0-1.5 0v2.25H9Z"/></svg>
        ${repoShort ? `<span class="meta-repo">${escHtml(repoShort)}</span>` : ''}
        ${dateStr ? `<span class="meta-dot">Â·</span><span class="meta-time">${dateStr}</span>` : ''}
        ${diffHtml}
        ${badgeHtml}
      </div>`;
    listEl.appendChild(div);
  });
}

function filterSessions(q) {
  if (!q.trim()) { renderSessionList(allSessions); return; }
  const lo = q.toLowerCase();
  renderSessionList(allSessions.filter(s => s.title.toLowerCase().includes(lo)));
}

async function selectSession(id) {
  if (id === currentSessionId) return;
  currentSessionId = id;
  await loadSessionHistory(id, true);
}

async function loadSessionHistory(id, switchView=false) {
  try {
    const res  = await fetch(`/sessions/${id}`);
    const data = await res.json();
    if (data.success) {
      document.getElementById('messages').innerHTML = '';
      msgCounter = 0;
      if (data.history && data.history.length > 0) {
        hideEmptyState();
        data.history.forEach(msg => {
          if (msg.role === 'user')      appendUser(msg.content);
          else if (msg.role === 'assistant') { const mid = createSidarMsg(); finalizeMsg(mid, msg.content); }
        });
      } else {
        showEmptyState();
      }
      // BaÅŸlÄ±ÄŸÄ± gÃ¼ncelle
      const sess = allSessions.find(s => s.id === id);
      if (sess) updateRightTitle(sess.title);
      loadSessions();
    }
  } catch (err) { console.error("GeÃ§miÅŸ yÃ¼klenemedi:", err); }
}

async function createNewSession() {
  try {
    const res  = await fetch('/sessions/new', { method: 'POST' });
    const data = await res.json();
    if (data.success) {
      currentSessionId = data.session_id;
      document.getElementById('messages').innerHTML = '';
      document.getElementById('left-prompt').value  = '';
      document.getElementById('input-area').value   = '';
      msgCounter = 0;
      showEmptyState();
      updateRightTitle('Yeni Sohbet');
      await loadSessions();
    }
  } catch (err) { console.error("Yeni sohbet oluÅŸturulamadÄ±:", err); }
}

async function deleteSession(id, event) {
  event.stopPropagation();
  if (!confirm('Bu sohbet kalÄ±cÄ± olarak silinecek. Emin misiniz?')) return;
  try {
    const res  = await fetch(`/sessions/${id}`, { method: 'DELETE' });
    const data = await res.json();
    if (data.success) {
      if (currentSessionId === id) { showEmptyState(); updateRightTitle('SÄ°DAR'); }
      await loadSessions();
      if (data.active_session && currentSessionId === id) {
        currentSessionId = data.active_session;
        loadSessionHistory(currentSessionId, false);
      }
    }
  } catch (err) { console.error("Sohbet silinemedi:", err); }
}

/* â”€â”€â”€ Right panel yardÄ±mcÄ±larÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateRightTitle(title) {
  const el = document.getElementById('right-title');
  if (el) el.textContent = title;
}
function showEmptyState() {
  let el = document.getElementById('empty-state');
  if (!el) {
    el = document.createElement('div');
    el.id = 'empty-state';
    el.className = 'empty-state';
    el.innerHTML = '<div class="empty-state-icon">SI</div><p>Sol taraftaki kutuya bir gÃ¶rev yazÄ±n<br>veya sohbet alanÄ±ndan mesaj gÃ¶nderin</p>';
    document.getElementById('messages').appendChild(el);
  }
  el.style.display = 'flex';
}
function hideEmptyState() {
  const el = document.getElementById('empty-state');
  if (el) el.remove();
}

/* â”€â”€â”€ PR Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showPRBar(base, head, addedN, removedN, url) {
  currentPRUrl = url || null;
  document.getElementById('pr-base').textContent = base;
  document.getElementById('pr-head').textContent = head;
  document.getElementById('pr-add').textContent  = `+${addedN||0}`;
  document.getElementById('pr-del').textContent  = `-${removedN||0}`;
  document.getElementById('pr-bar').removeAttribute('hidden');
}
function hidePRBar() {
  document.getElementById('pr-bar').setAttribute('hidden','');
  currentPRUrl = null;
}
function viewPR() {
  if (currentPRUrl) window.open(currentPRUrl, '_blank', 'noopener');
}

/* â”€â”€â”€ Sol panel prompt gÃ¶nder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startFromLeftPrompt() {
  const text = document.getElementById('left-prompt').value.trim();
  if (!text) return;
  document.getElementById('left-prompt').value = '';
  hideEmptyState();
  sendText(text);
}

/* â”€â”€â”€ Textarea auto-resize â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
['left-prompt','input-area'].forEach(id => {
  const el = document.getElementById(id);
  if (!el) return;
  el.addEventListener('input', () => {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, id === 'left-prompt' ? 160 : 200) + 'px';
  });
  el.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      id === 'left-prompt' ? startFromLeftPrompt() : sendMessage();
    }
  });
});

/* â”€â”€â”€ Streaming durdur â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function stopStreaming() {
  if (activeController) activeController.abort();
}

/* â”€â”€â”€ Dosya ekleme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function handleFileAttach(e) {
  const file = e.target.files[0];
  if (!file) return;
  if (file.size > 200 * 1024) { alert('Dosya boyutu 200 KB\'Ä± aÅŸamaz.'); e.target.value=''; return; }
  const reader = new FileReader();
  reader.onload = ev => {
    attachedFileContent = ev.target.result;
    attachedFileName    = file.name;
    renderAttachedFile(file.name);
  };
  reader.readAsText(file, 'utf-8');
  e.target.value = '';
}
function renderAttachedFile(name) {
  document.getElementById('attached-file-preview').innerHTML = `
    <div class="attached-file">
      <svg width="11" height="11" viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/></svg>
      <span>${escHtml(name)}</span>
      <button class="attached-file-remove" onclick="removeAttachedFile()">âœ•</button>
    </div>`;
}
function removeAttachedFile() {
  attachedFileContent = null; attachedFileName = null;
  document.getElementById('attached-file-preview').innerHTML = '';
}

/* â”€â”€â”€ Mesaj gÃ¶nderme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function sendMessage() {
  const textarea = document.getElementById('input-area');
  const text = textarea.value.trim();
  if (!text && !attachedFileContent) return;
  const finalText = attachedFileContent
    ? `${text}\n\n**Dosya: ${attachedFileName}**\n\`\`\`\n${attachedFileContent}\n\`\`\``
    : text;
  textarea.value = '';
  textarea.style.height = 'auto';
  removeAttachedFile();
  hideEmptyState();
  sendText(finalText);
}

async function sendText(text) {
  if (isStreaming) return;
  isStreaming = true;
  const sendBtn   = document.getElementById('send-btn');
  const lSendBtn  = document.getElementById('left-send-btn');
  const stopBtn   = document.getElementById('stop-btn');
  if (sendBtn)  { sendBtn.disabled  = true; sendBtn.style.opacity  = '.35'; }
  if (lSendBtn) { lSendBtn.disabled = true; lSendBtn.style.opacity = '.35'; }
  if (stopBtn)  stopBtn.style.display = 'flex';

  appendUser(text);
  const msgId = createSidarMsg();
  let accumulated = '';
  activeController = new AbortController();
  let timeoutId = null;
  const resetTimeout = () => {
    if (timeoutId) clearTimeout(timeoutId);
    timeoutId = setTimeout(() => activeController.abort(), 60000);
  };
  try {
    resetTimeout();
    const response = await fetch('/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: text }),
      signal: activeController.signal
    });
    if (!response.ok) { finalizeMsg(msgId, `[HTTP HatasÄ±] Sunucu ${response.status} dÃ¶ndÃ¼rdÃ¼.`); return; }
    const reader  = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = '';
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      resetTimeout();
      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split('\n');
      buffer = lines.pop();
      for (const line of lines) {
        if (!line.startsWith('data: ')) continue;
        try {
          const parsed = JSON.parse(line.slice(6).trim());
          if (parsed.done) break;
          if (parsed.chunk) { accumulated += parsed.chunk; updateStreaming(msgId, accumulated); }
        } catch { /* skip */ }
      }
    }
  } catch (err) {
    if (err.name === 'AbortError') accumulated += accumulated ? '\n\n*[YanÄ±t durduruldu.]*' : '*[YanÄ±t durduruldu.]*';
    else accumulated += `\n\n[BaÄŸlantÄ± HatasÄ±: ${err.message}]`;
  } finally {
    if (timeoutId) clearTimeout(timeoutId);
    activeController = null;
    finalizeMsg(msgId, accumulated);
    isStreaming = false;
    if (sendBtn)  { sendBtn.disabled  = false; sendBtn.style.opacity  = '1'; }
    if (lSendBtn) { lSendBtn.disabled = false; lSendBtn.style.opacity = '1'; }
    if (stopBtn)  stopBtn.style.display = 'none';
    loadSessions();
  }
}

/* â”€â”€â”€ Mesaj yardÄ±mcÄ±larÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function escHtml(str) {
  const d = document.createElement('div');
  d.appendChild(document.createTextNode(str));
  return d.innerHTML;
}
function scrollBottom() {
  const msgs = document.getElementById('messages');
  msgs.scrollTop = msgs.scrollHeight;
}
function appendUser(text) {
  const msgs = document.getElementById('messages');
  const el = document.createElement('div');
  el.className = 'message message-user';
  el.innerHTML = `
    <div class="msg-header"><div class="msg-avatar avatar-user">S</div><span>Sen</span></div>
    <div class="msg-body" style="white-space:pre-wrap">${escHtml(text)}</div>
    <div class="msg-actions">
      <button class="msg-action-btn" onclick="editMessage(this, ${JSON.stringify(text)})">âœ DÃ¼zenle</button>
      <button class="msg-action-btn" onclick="copyText(${JSON.stringify(text)}, this)">ğŸ“‹ Kopyala</button>
    </div>`;
  msgs.appendChild(el);
  scrollBottom();
}
function editMessage(btn, originalText) {
  const inp = document.getElementById('input-area');
  inp.value = originalText;
  inp.style.height = 'auto';
  inp.style.height = Math.min(inp.scrollHeight, 200) + 'px';
  inp.focus();
}
function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    const orig = btn.textContent;
    btn.textContent = 'âœ“ KopyalandÄ±';
    setTimeout(() => btn.textContent = orig, 1500);
  });
}
function createSidarMsg() {
  const msgs = document.getElementById('messages');
  const id   = `m${++msgCounter}`;
  const el   = document.createElement('div');
  el.className = 'message message-sidar';
  el.id = id;
  el.innerHTML = `
    <div class="msg-header"><div class="msg-avatar avatar-sidar">SI</div><span>Sidar</span></div>
    <div class="msg-body"><span class="streaming-text" id="${id}-txt"></span><span class="cursor" id="${id}-cur"></span></div>`;
  msgs.appendChild(el);
  scrollBottom();
  return id;
}
function updateStreaming(id, rawText) {
  const span = document.getElementById(`${id}-txt`);
  if (span) span.textContent = rawText;
  scrollBottom();
}
function finalizeMsg(id, rawText) {
  const el = document.getElementById(id);
  if (!el) return;
  const body   = el.querySelector('.msg-body');
  const cursor = document.getElementById(`${id}-cur`);
  if (cursor) cursor.remove();
  body.innerHTML = marked.parse(rawText || '*(yanÄ±t alÄ±namadÄ±)*');
  body.querySelectorAll('pre code').forEach(b => hljs.highlightElement(b));
  body.querySelectorAll('pre').forEach(pre => {
    const wrap = document.createElement('div');
    wrap.className = 'code-wrap';
    pre.parentNode.insertBefore(wrap, pre);
    wrap.appendChild(pre);
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.innerHTML = `<svg width="10" height="10" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg> Kopyala`;
    btn.onclick = () => {
      const code = pre.querySelector('code');
      navigator.clipboard.writeText(code ? code.innerText : pre.innerText).then(() => {
        btn.textContent = 'âœ“ KopyalandÄ±'; btn.classList.add('copied');
        setTimeout(() => { btn.innerHTML = `<svg width="10" height="10" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/></svg> Kopyala`; btn.classList.remove('copied'); }, 2000);
      });
    };
    wrap.appendChild(btn);
  });
  scrollBottom();
}

/* â”€â”€â”€ Repo & Branch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openRepoModal() {
  renderRepos(REPOS);
  document.getElementById('repo-search').value = '';
  document.getElementById('repo-modal').classList.add('open');
  setTimeout(() => document.getElementById('repo-search').focus(), 50);
}
function renderRepos(list) {
  document.getElementById('repo-list').innerHTML = list.map(r => `
    <div class="repo-item ${r.name===currentRepo?'selected':''}" onclick="selectRepo('${r.name}')">
      <div class="repo-item-icon">${r.emoji}</div>
      <div class="repo-item-info">
        <div class="repo-item-name">${r.name}</div>
        <div class="repo-item-meta">${r.desc}</div>
      </div>
      <span class="repo-item-check">âœ“</span>
    </div>`).join('');
}
function filterRepos(q) { renderRepos(REPOS.filter(r => r.name.toLowerCase().includes(q.toLowerCase()))); }
function selectRepo(name) {
  currentRepo = name;
  document.getElementById('repo-label').textContent = name;
  closeModal('repo-modal');
}
function openBranchModal() {
  renderBranches(BRANCHES);
  document.getElementById('branch-search').value = '';
  document.getElementById('branch-modal').classList.add('open');
  setTimeout(() => document.getElementById('branch-search').focus(), 50);
}
function renderBranches(list) {
  document.getElementById('branch-list').innerHTML = list.map(b => `
    <div class="repo-item ${b===currentBranch?'selected':''}" onclick="selectBranch('${b}')">
      <div class="repo-item-icon" style="font-size:16px">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="var(--text-dim)"><path d="M11.75 2.5a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Zm-2.25.75a2.25 2.25 0 1 1 3 2.122V6A2.5 2.5 0 0 1 10 8.5H6a1 1 0 0 0-1 1v1.128a2.251 2.251 0 1 1-1.5 0V5.372a2.25 2.25 0 1 1 1.5 0v1.836A2.492 2.492 0 0 1 6 7h4a1 1 0 0 0 1-1v-.628A2.25 2.25 0 0 1 9.5 3.25ZM4.25 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5ZM3.5 3.25a.75.75 0 1 1 1.5 0 .75.75 0 0 1-1.5 0Z"/></svg>
      </div>
      <div class="repo-item-info"><div class="repo-item-name">${b}</div></div>
      <span class="repo-item-check">âœ“</span>
    </div>`).join('');
}
function filterBranches(q) { renderBranches(BRANCHES.filter(b => b.toLowerCase().includes(q.toLowerCase()))); }
function selectBranch(name) {
  currentBranch = name;
  document.getElementById('branch-label').textContent = name;
  closeModal('branch-modal');
}

/* â”€â”€â”€ Modal yardÄ±mcÄ±larÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function modalBgClose(e, id) { if (e.target === document.getElementById(id)) closeModal(id); }

/* â”€â”€â”€ Durum modalÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function openStatus() {
  document.getElementById('status-modal').classList.add('open');
  const grid = document.getElementById('stat-grid');
  grid.innerHTML = '<div class="stat-row"><span class="stat-label">YÃ¼kleniyorâ€¦</span></div>';
  try {
    const data = await (await fetch('/status')).json();
    const row = (label, value, cls='') =>
      `<div class="stat-row"><span class="stat-label">${label}</span><span class="stat-val ${cls}">${value}</span></div>`;
    grid.innerHTML = [
      row('SÃ¼rÃ¼m',           `v${data.version}`),
      row('AI SaÄŸlayÄ±cÄ±',   `${data.provider} / ${data.model}`),
      row('EriÅŸim Seviyesi', data.access_level.toUpperCase()),
      row('Bellek',          `${data.memory_count} mesaj`),
      row('GitHub',   data.github     ? 'âœ“ BaÄŸlÄ±'   : 'âœ— BaÄŸlÄ± deÄŸil', data.github     ? 'ok' : 'warn'),
      row('Web Arama', data.web_search ? 'âœ“ Aktif'   : 'âœ— Kurulu deÄŸil', data.web_search ? 'ok' : 'warn'),
      row('RAG',       data.rag_status),
      row('Paket Bilgi', 'âœ“ PyPI + npm + GitHub', 'ok'),
    ].join('');
  } catch (err) {
    grid.innerHTML = `<div class="stat-row"><span class="stat-label">Hata: ${escHtml(err.message)}</span></div>`;
  }
}

/* â”€â”€â”€ Bellek temizle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function clearMemory() {
  if (!confirm('GeÃ§erli konuÅŸma belleÄŸi temizlenecek. Devam edilsin mi?')) return;
  try { await fetch('/clear', { method: 'POST' }); } catch { /* ignore */ }
  document.getElementById('messages').innerHTML = '';
  showEmptyState();
  updateRightTitle('SÄ°DAR');
  loadSessions();
}

/* â”€â”€â”€ KÄ±sayollar modalÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openShortcuts() { document.getElementById('shortcuts-modal').classList.add('open'); }

/* â”€â”€â”€ Share â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function shareSession() {
  navigator.clipboard.writeText(window.location.href).then(() => alert('BaÄŸlantÄ± kopyalandÄ±!')).catch(() => {});
}

/* â”€â”€â”€ Tarih formatlama â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function formatRelativeTime(isoStr) {
  if (!isoStr) return '';
  try {
    const d    = new Date(isoStr);
    const diff = (Date.now() - d.getTime()) / 1000;
    if (diff < 60)     return 'az Ã¶nce';
    if (diff < 3600)   return `${Math.floor(diff/60)}dk`;
    if (diff < 86400)  return d.toLocaleTimeString('tr-TR', { hour:'2-digit', minute:'2-digit' });
    if (diff < 604800) return d.toLocaleDateString('tr-TR', { weekday:'short' });
    return d.toLocaleDateString('tr-TR', { day:'numeric', month:'short' });
  } catch { return ''; }
}

/* â”€â”€â”€ Global klavye kÄ±sayollarÄ± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    ['repo-modal','branch-modal','status-modal','shortcuts-modal'].forEach(closeModal);
    if (isStreaming) stopStreaming();
    return;
  }
  const tag = document.activeElement.tagName;
  if (tag === 'INPUT' || tag === 'TEXTAREA') return;
  if (e.ctrlKey && e.key === 'k') { e.preventDefault(); createNewSession(); }
  if (e.ctrlKey && e.key === 'l') { e.preventDefault(); clearMemory(); }
  if (e.ctrlKey && e.key === 't') { e.preventDefault(); toggleTheme(); }
});
</script>
</body>
</html>
